{
    "collab_server" : "",
    "contents" : "setwd(\"E:/SNP data/combine_QC\")\nlibrary(sequoia)\n\n# First: combine files & do QC using PLINK\n# see `Deer_SNP_QC.R'\n\n\n# subset SNPs & recode to 0/1/2\nsystem(\"cmd\", input = \"plink --autosome-num 33 --bfile 2_02_Data_PLINK_Intermediate/Deer33P_QC4 --extract 2_04_Files_for_PLINK_QC/Parentage_SNPs.txt --mind 0.1 --recodeA --out 3_01_Data_Pedigree-IN/DeerP33\")\n# 440 variants and 2962 samples pass filters and QC.\n\n\nsetwd(\"3_01_Data_Pedigree-IN\")\n\n# 3. convert genotype file\nGenoM <- GenoConvert(InFile = \"DeerP33.raw\", InFormat = \"raw\")\n\n\n# 4. dataframe with sex & birth year info\ntblLife <- read.table(\"tblLife_2017-07.txt\", header=T,\n                      na.strings=c(\"\"), sep=\"\\t\", stringsAsFactors=FALSE)\nLH <- tblLife[, c(\"Code\", \"Sex\", \"BirthYear\")]\n\nchk <- rownames(GenoM)[!rownames(GenoM) %in% LH$Code]\n# mostly mystery samples\n\nLH_extra <- as.data.frame(matrix(c(\"PM98-S02\", 2, 1989,\n                                   \"PM99-S02\", 2,\t1985,\n                                   \"PM97-C01\", 2, 1997,\n                                   \"PM88-H03\", 1, 1975,\n                                   \"DSA99\", 2, -9,\n                                   \"DSA98\", 2, 1995,\n                                   \"DSA97\", 2, 1983,\n                                   \"DSA07\", 2, -9,\n                                   \"ZEB87_Q\", 3, 1987,\n                                   \"HEX17\", 3, 2017,  # late calf\n                                   \"DSA17\", 2, -9,\n                                   \"GL382\", 1, 1982),\n                                 ncol=3, byrow=TRUE),\n                          stringsAsFactors=FALSE)\nfor (x in 2:3) LH_extra[, x] <- as.numeric(LH_extra[, x])\nLH <- rbind(LH, setNames(LH_extra, names(LH)))\nLH$BirthYear[LH$Code==\"BIGSG\"] <- 1975  # assuming LONGS=BIGSG\n\ntblLife$SNPd <- tblLife$Code %in% rownames(GenoM)\n\n\n\nsetwd(\"../3_02_Data_Pedigree-OUT\")\n\n\n#=============================\n#=== parentage assignment ====\n#=============================\n\nDeerPar <- sequoia(GenoM = GenoM,\n                   LifeHistData = LH,\n                   Err = 1e-3,\n                   MaxMismatch=5,\n                   MaxSibIter = 0)   # takes few minutes\n\nDeerPar$DupGenotype\n#   row1 row2   ID1   ID2 Mismatch      LLR\n# 2 1456 2101 RAP97 GRT03        0 103.0090  # duplicate or inbred ?\n\n\n# check mums\nParComp <- PedCompare(Ped1 = cbind(tblLife[, c(\"Code\", \"MumCode\")], sire=NA),\n                      Ped2 = DeerPar$PedigreePar)\nParComp$Counts[\"GG\",,\"dam\"]\n  # Total    Match Mismatch   P1only   P2only\n  #   2342     2339        0        0        3\n\n# P1only: parent-offspring in tblLife but not in genetic pedigree\n# GG: both offspring & (putative) parent genotyped\n\n\n# P2 only: parent-offspring in genetic pedigree but not in tblLife\nParComp$P2only[ParComp$P2only$Cat==\"GG\" & ParComp$P2only$Parent==\"dam\", ]\n#            id dam.1 sire.1    dam.2 sire.2     id.r dam.r sire.r Cat Parent\n# 2931 PM89-C01  <NA>   <NA> PM89-H01  CHEST PM89-C01    NA     NA  GG    dam  # mystery deads calf + hind\n# 2942    LAPxx  <NA>   <NA>    MOL75   <NA>    LAPxx    NA     NA  GG    dam  # LAP84 or LAP85, SampleID PM88-X02\n# 2960    HEX17  <NA>   <NA>    HED08  OXY09    HEX17    NA     NA  GG    dam  # late calf, OK\n\n\n\nDeerPar$MaybeParent\n#     ID1   ID2 Sex1 Sex2 AgeDif TopRel   LLR OH\n# 4 DSA99 TOR76    2    2     NA     PO  7.33  0\n# 3 TAL71 TAL70    1    1      1     FS 10.08  6\n# 1 CPY08 CPY06    1    2      2     FS  7.02  4\n# 5 VER85 TRN77    2    2      8     GP  7.75  0\n# 6 SAF83 LIC74    2    2      9     GP  0.32  0\n# 2 GRT03 THU94    2    1      9     FA  6.90  0\n\n\n\n#=============================\n#=== sibship clustering ======\n#=============================\n\n# takes 1-2 hours:\nDeerFull <- sequoia(GenoM = GenoM,\n                   LifeHistData = LH,\n                   Err = 1e-3,\n                   MaxMismatch=5,\n                   UseAge = \"extra\",\n                   MaxSibIter = 20)\n\n\nsave(DeerFull, file=\"Sequoia_DeerFull_new.RData\")\n\nPed <- merge(DeerFull$Pedigree, LH, by.x=\"id\", by.y=\"Code\", all.x=TRUE)\n\n\n\nPed2 <- read.table(\"E:/Sequoia/Bugs & queries/bug 2018-05/Pedigree_seq.txt\",\n                   header=T, stringsAsFactors=F)\nPed2[Ped2==999] <- NA\nhist(Ped2$LLRpair, breaks=50, col=\"grey\")\nchk <- Ped2[which(Ped2$LLRpair < 0), ]\n#         id   dam  sire LLRdam LLRsire LLRpair\n# 1810 FIL90 F0130 M0066   1.86    0.15   -0.18  # OK (relies on age)\n# 3020 F0058 F0128 M0087   2.80    2.05   -0.48  # OK\n# 3089 F0127 F0023 UPR72   0.00    0.49   -2.14  # OK. dummy:real ratio\n\n\n\nchk <- Ped2[which(Ped2$LLRdam < 0), ]  # OK\n\nchk <- Ped2[which(Ped2$LLRsire < 0), ]\n# F0043  <NA> SCO71     NA   -1.33      NA  OK, FAG79, microsat father\n# M0054  <NA> M0111     NA   -0.54      NA  plausible.\n\n\n\nPedComp <- PedCompare(Ped1 = cbind(tblLife[, c(\"Code\", \"MumCode\")], sire=NA),\n                      Ped2 = Ped2)\nPedComp$Counts[,,\"dam\"]\n# was:\n#    Total Match Mismatch P1only P2only\n# GG  2337  2333        0      0      4\n# GD   491   416        3     64      8\n# GT  2839  2749        3     75     12\n# DG    68    59        0      8      1\n# DD    51    29        0     21      1\n# DT   136    88        0     46      2\n# TT  4353  2837        3   1470     43\n\n# extra reliance on ageprior in last round:\n#    Total Match Mismatch P1only P2only\n# GG  2337  2333        0      0      4\n# GD   499   442        4     37     16\n# GT  2847  2775        4     48     20\n# DG    68    61        1      5      1\n# DD    53    33        2     17      1\n# DT   136    94        2     38      2\n# TT  4363  2869        6   1435     53\n\n# AR: +42, mismatch: +3\n\n\n#    Total Match Mismatch P1only P2only\n# GG  2342  2339        0      0      3\n# GD   493   426        3     55      9\n# GT  2846  2765        3     66     12\n# DG    67    57        1      8      1\n# DD    53    29        2     21      1\n# DT   135    86        2     45      2\n# TT  4351  2851        5   1454     41\n\nPedComp$Mismatch\n#         id dam.1 sire.1 dam.2 sire.2  id.r   dam.r sire.r Cat Parent\n# 319  SSK04 CHF01   <NA> F0104  CEDRI SSK04 nomatch     NA  GD    dam\n# 2423 SSK06 CHF01   <NA> F0100  TNY94 SSK06 nomatch     NA  GD    dam  # merge fail.\n\n# 2094 KID90 ADZ84   <NA> F0126  SEP83 KID90 nomatch     NA  GD    dam  # is probably CHP90\n# 3015 F0126 MOY74   <NA> F0023  UPR72 ADZ84   BLO72     NA  DG    dam  #\n# 2994 F0054 BLC83   <NA> F0126  PEP85 CHP94 nomatch     NA  DD    dam\n\n# 1473 FIL90 EIF81   <NA> F0130  M0066 FIL90 nomatch     NA  GD    dam  # error.\n\nchk <- PedComp$P2only[PedComp$P2only$Parent==\"dam\", ]\n\n\n\nPedM[which(PedM$dam.2==\"F0119\"), ]\n#         id dam.1 sire.1 dam.2 sire.2    id.r dam.r sire.r\n# 1404 CRT72 CROTT   <NA> F0119  M0052    <NA> CROTT     NA\n# 1612 CRT77 CROTT   <NA> F0119  MAXIS    <NA> CROTT     NA\n# 2981 F0027 CROTT   <NA> F0119  MAXIS   CRT76 CROTT     NA\n# 3003 F0066 CROTT   <NA> F0119  SAGGY   CRT74 CROTT     NA\n# 3202 F0130  <NA>   <NA> F0119   <NA> nomatch CROTT     NA  # error.\n\n\n\nPedM <- PedComp$MergedPed\nchk <- with(PedM, PedM[which(dam.1!=dam.2 & dam.1!=dam.r), ])\n#         id dam.1 sire.1 dam.2 sire.2 id.r   dam.r sire.r\n# 184  JOA88 JAN82   <NA> F0062  BIGSG <NA> nomatch     NA  # sample swap?\n# 317  SSK04 CHF01   <NA> F0107  CEDRI <NA> nomatch     NA\n# 2406 SSK06 CHF01   <NA> F0103  TNY94 <NA> nomatch     NA  # merge fail\n\n# 2103 KID90 ADZ84   <NA> F0140  SEP83  <NA> nomatch     NA\n# 2987 F0054 BLC83   <NA> F0140  PEP85 CHP94 nomatch     NA  # FAL03,FAL99 OK\n# 3009 F0140 MOY74   <NA> F0021  UPR72 ADZ84   BLO72     NA\n\n\nPedM[which(PedM$dam.2==\"F0062\"), ]\n#        id dam.1 sire.1 dam.2 sire.2 id.r   dam.r sire.r\n# 184 JOA88 JAN82   <NA> F0062  BIGSG <NA> nomatch     NA\n# 342 SLITS  <NA>   <NA> F0062  CHE75 <NA> nomatch     NA  # est. born '82. from PM ear\n\n\n\nchk <- with(PedM, PedM[is.na(dam.1) & !is.na(dam.2), c(\"id\", \"id.r\", \"dam.2\", \"dam.r\", \"sire.2\")])\n\nPedM[which(PedM$dam.2==\"F0009\"), ]\n#            id dam.1 sire.1 dam.2 sire.2 id.r   dam.r sire.r\n# 341     NIBSI  <NA>   <NA> F0009  CHE75 <NA> nomatch     NA\n# 3091 PM89-H01  <NA>   <NA> F0009  CPBPT <NA> nomatch     NA\n# 3109    M0008  <NA>   <NA> F0009  LIC76 <NA> nomatch     NA  # BLF95, MLN97, ..\n# 874     F0009  <NA>   <NA>    NA     NA    NA  NA        NA\n\nPedM[which(PedM$dam.2==\"F0062\"), ]\n\n\nPed[which(Ped$dam==\"F0129\"), ]\n#         id   dam  sire LLRdam LLRsire LLRpair Sex BirthYear\n# 2000 NICKS F0129  <NA>      0      NA      NA   2      1965\n# 2073 OTAGG F0129 M0110      0       0    0.86   1      1966\n# not convinced: NICKS has r=0.02 - 0.09 with OTAGG's offspring, expect 0.125\n\n\n##################################################\n# inbreeding\n\nsetwd(\"..\")\n\nsystem(\"cmd\", input = \"gcta --bfile PLINK_data/Deer33P_QC --autosome --autosome-num 29 --ibc --out 06-Output/Deer33\")\n\n\nInbr.snp <- read.table(\"06-Output/Deer33.ibc\", header=TRUE, stringsAsFactors=FALSE)\nInbr.snp <- merge(Inbr.snp, tblLife[, c(\"Code\", \"BirthYear\")], by.x=\"IID\", by.y=\"Code\", all.x=TRUE)\n\nhist(Inbr.snp$Fhat3, breaks=100, col=\"grey\")\nInbr.snp[Inbr.snp$Fhat3>.2, ]\n\n\n\n##################################################\n\nsystem(\"cmd\", input = \"gcta --bfile PLINK_data/Deer33P_QC --autosome --autosome-num 29 --make-grm  --out 06-Output/Deer33\")\n\nsource(\"E:/R functions/util functions.R\")  # defines Get()\nRel.snp <- read.table(\"4_01_Data_Other/Deer_2018-02-27.grm.gz\")\nRel.id <- read.table(\"4_01_Data_Other/Deer_2018-02-27.grm.id\", stringsAsFactors=FALSE)\n#Rel.id[Rel.id[,2]==\"PM07-S02\", 2] <- \"DSA07\"\n#Rel.id[Rel.id[,2]==\"ZEB87_Q\", 2] <- \"DSA97\"\n#Rel.id[Rel.id[,2]==\"PM98-S01\", 2] <- \"DSA98\"\nRel.snp[,1] <- as.character(factor(Rel.snp[,1], labels=Rel.id[,2]))\nRel.snp[,2] <- as.character(factor(Rel.snp[,2], labels=Rel.id[,2]))\nnames(Rel.snp) <- c(\"IID2\", \"IID1\", \"SNPS\", \"R.SNP\")\nRel.snp <- Rel.snp[Rel.snp$IID1 != Rel.snp$IID2,]\n\nsave(Rel.snp, file=\"04-Intermediate Data/Rel_snp.RData\")\n\n\n\n# UHA16 really Jeep'16? or sired by CHK09 aka LEAVE?\nGet(\"JEP16\", th=.15)\n # SHZ12 JEP16 0.222\n # JEP16 NAV13 0.202  # Roger\n # JEP16 SOX04 0.180\n # JEP16 CRX10 0.175  # Roger\n # JEP16 OYS13 0.170\n # DAI12 JEP16 0.168  # Roger\n # JEP16 PUM10 0.166  # Roger\n # JEP16 SPY13 0.160  # Roger\n # CRX12 JEP16 0.158  # Roger\n # JEP16 BIJ13 0.153\n # EMB12 JEP16 0.152\n\n\nGet(\"SHZ12\", th=.15)\n #  IID1  IID2 R.SNP\n # SHZ12 MLT07 0.492  dam\n # SHZ12 CRM03 0.294  mgm\n # SHZ12 JEP16 0.222\n # SHZ12 DIL99 0.190  mgf\n\nGet(\"SHZ12\", v=Ped$id[which(Ped$sire==\"M0042\")])  # mean: -0.012\nGet(\"JEP16\", v=Ped$id[which(Ped$sire==\"M0042\")])  # mean: 0.144 (0.085 - 0.20)\nGet(\"SOX04\", v=Ped$id[which(Ped$sire==\"M0042\")])  # -0.011\n\nget2(\"SHZ12\", \"SOX04\")  # 0.01\nget2(\"MLT07\", \"JEP16\")  # -0.03\n\n# working hypothesis: CHK12 sired by Roger (can't be father of JEP16, as last seen 2012)\n\n\nget2(\"SHZ12\", \"NAV13\")  # -0.01\n# SHZ12: female, shot as calf, mother no proper rut obs\n\n\n\n#========================================\n# last round extra reliance on ageprior during clustering\nPed9 <- ReadTable(\"sequoia/Pedigree_round 9.txt\", sep=\"\")\nPC9 <- PedCompare(Ped1 = cbind(tblLife[, c(\"Code\", \"MumCode\")], sire=NA),\n                       Ped2 = Ped9)\n# , , dam\n#    Total Match Mismatch P1only P2only\n# GG  2337  2333        0      0      4\n# GD   483   436        0     42      0\n# GT  2842  2769        5     53     15\n# DG    69    59        1      8      1\n# DD    50    32        0     16      0\n# DT   136    91        2     41      2\n# TT  4358  2860        7   1443     48\nPedM9 <- PC9$MergedPed\nchk <- with(PedM9, PedM9[which(dam.1!=dam.2 & is.na(dam.r)), ])\n#         id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r\n# 184  JOA88 JAN82   <NA> F0062  BIGSG  <NA>  <NA>     NA  # was error: not MHS w SLITS\n# 317  SSK04 CHF01   <NA> F0107  CEDRI  <NA>  <NA>     NA  # was error: merge fail\n# 2440 SSK06 CHF01   <NA> F0103  TNY94  <NA>  <NA>     NA\n# 1394 PGB83 SOB68   <NA> F0136  M0050  <NA>  <NA>     NA\n# 2979 F0050 SOB68   <NA> F0136  NTRYL PGB75  <NA>     NA\n# 1866 THR80 PGB76   <NA> F0136  RED72  <NA>  <NA>     NA  # GP / GGP error\n# 3030 F0134 COL72   <NA> COLLE   <NA> CLC75  <NA>     NA  # GP / GGP error\n\n\n\n\n#==========================\nwith(Rel, hist(R.GRM[R.ped==0.25], breaks=100, col=\"grey\", xlim=c(0,.5)))\nabline(v=0.07, lwd=2, col=2)\nchk <- Rel[which(Rel$R.ped>=0.25 & Rel$R.GRM<=0.07), ]\nprint(chk, row.names=F)\n #  IID1  IID2  SNPS      R.GRM     R.ped\n # ANK90 IRI13 37289 0.06741046 0.2592773\n # COL78 MOS78 37287 0.06335009 0.2500000\n # CUM97 MAXIS 37279 0.05166735 0.2500000\n # SKI97 BAR83 37281 0.06726452 0.2500000\n # KID90 MOY74 37229 0.06976449 0.2500000  # should be MGM\n # WHS90 MOY76 37289 0.06676504 0.2500000  # seems OK\n\n\nchk <- Get(\"KID90\", th=.15)\nchk <- merge(chk, setnames(tblLife[, c(\"Code\", \"BirthYear\")],\n                           c(\"IID1\", \"BY1\")), all.x=TRUE)\nchk <- merge(chk, setnames(tblLife[, c(\"Code\", \"BirthYear\")],\n                           c(\"IID2\", \"BY2\")), all.x=TRUE)\nchk <- chk[which(chk$BY1<=1990 & chk$BY2<=1990), ]\n#     IID2  IID1 R.GRM     R.ped  BY1  BY2\n# 43 SEP83 KID90 0.464 0.5000000 1990 1983  # sire\n# 45 UPR72 KID90 0.315 0.0312500 1990 1972  # MGF?\n# 8  FAISA KID90 0.285 0.0000000 1990 1957  # double MGGP?\n# 44 SWI89 KID90 0.282 0.3125000 1990 1989  # PHS\n# 3  BLC81 KID90 0.279 0.1328125 1990 1981  # MHA?\n# 5  CHO73 KID90 0.257 0.2500000 1990 1973  # PGM\n# 38 MAG72 KID90 0.209 0.0000000 1990 1972  # sired by FAISA\n# 40 MOM72 KID90 0.191 0.0000000 1990 1972  # sired by FAISA\n# 9  FOL83 KID90 0.189 0.1328125 1990 1983  # sired by GROWT\n# 11 GROWT KID90 0.183 0.2500000 1990 1971  # PGF\n# 37 LIT72 KID90 0.170 0.0000000 1990 1972  # sired by FAISA\n# 4  BUL72 KID90 0.159 0.0000000 1990 1972  # sired by FAISA\n# 36 KIL82 KID90 0.159 0.0312500 1990 1982  # sired by UPR72\n# 39 MAW81 KID90 0.159 0.1640625 1990 1981  # sired by GROWT\n# 42 RGR69 KID90 0.157 0.0000000 1990 1969  # sired by FAISA\n\n\n\n\nGet(\"KID90\", v=Ped$id[which(Ped$dam==\"F0048\")])\n # IID1  IID2  R.GRM    R.ped\n # KID90 MOY74  0.070 0.250000  # suspiciously low ...\n # KID90 MOY76  0.033 0.078125\n # KID90 MOY73  0.017 0.062500\n # KID90 MOY82 -0.004 0.062500\n\nPed[Ped$id==\"F0048\", ]\n#         id   dam  sire LLRdam LLRsire LLRpair\n# 3005 F0048 F0049 CRUSA   1.19    1.86    6.51\n\nGet(\"KID90\", v=Ped$id[which(Ped$dam==\"F0049\")])\n #  IID1  IID2 R.GRM   R.ped\n # KID90 UPR72 0.315 0.03125  <--\n # KID90 UPR71 0.039 0.06250\n # KID90 UPR75 0.033 0.03125\n # KID90 UPR73 0.029 0.03125\n # KID90 UPR78 0.017 0.03125\n\n\n# --> KID90 is probably CHP90 (male, assumed died jan '91)\n# --> check if PM of CHP90\n\n\n#==================================================\n#==================================================\n# check relatedness to maternal grandmother\n# for all SNPd individuals with non-SNPd mother\n\nMGMS <- merge(tblLife[!is.na(tblLife$MumCode), c(\"Code\", \"MumCode\", \"SNPd\")],\n              setNames(tblLife[, c(\"Code\", \"MumCode\", \"SNPd\")],\n                       c(\"MumCode\", \"MGM\", \"SNPd.mum\")),\n              all.x=TRUE)\nwith(MGMS, table(SNPd, SNPd.mum))\n#        SNPd.mum\n# SNPd    FALSE TRUE\n#   FALSE   738  745\n#   TRUE    494 2333\n\nMGMS$SNPd.mgm <- MGMS$MGM %in% Par$id\nMGMS <- with(MGMS, MGMS[SNPd & !is.na(MGM), ])\ntable(MGMS$SNPd.mum, MGMS$SNPd.mgm)\n#       FALSE TRUE\n# FALSE   197  209\n# TRUE    477 1831\n\n\nMGMS <- merge(MGMS, setNames(Rel.snp[, c(1,2,4)], c(\"Code\", \"MGM\", \"R.mgm\")),\n                all.x=TRUE)\nMGMS <- Merge(MGMS, setNames(Rel.snp[, c(2,1,4)], c(\"Code\", \"MGM\", \"R.mgm\")),\n                by=c(\"Code\", \"MGM\"), all.x=TRUE)\n\ntable(!is.na(MGMS$R.mgm))  # 1997  vs 717\n\npdf(\"06-Output/hist_Rgrm_MGM.pdf\", height=5, width=6)\npar(mfcol=c(1,1), mai=c(.9,.9,.3,.1))\nhist(MGMS$R.mgm, breaks=seq(0,.65,.005), col=\"grey\", freq=FALSE,\n     xlim=c(0, 0.5), ylim=c(0,11),\n     main=\"R.GRM to maternal grandmother\", xlab=\"R.GRM\")\nabline(v=0.25, lwd=3, lty=2)\ncurve(dnorm(x, 0.25, 0.0362), lwd=2, add=TRUE)  # SD from Hill & Weir 2011, tbl2 (human)\ndev.off()\n\nMGMS[which(MGMS$R.mgm < 0.1), ]\n#       Code   MGM MumCode SNPd SNPd.mum SNPd.mgm      R.mgm\n# 1229 KID90 MOY74   ADZ84 TRUE    FALSE     TRUE 0.06976449  # likely wrong.\n# 1398 MAR89 MOD74   MAW83 TRUE     TRUE     TRUE 0.09772575\n# 2144 SKI97 BAR83   OAT90 TRUE     TRUE     TRUE 0.06726452\n\n# KID90: likely wrong ID, seems to be CHP90\n\nGet(\"SKI97\")  # looks OK\n #  IID1  IID2 R.GRM R.ped\n # SKI97 SKI95 0.524   0.5\n # SKI95 FIL86 0.456   0.5\n # OAT90 SKI95 0.429   0.5\n\nget2(\"OAT90\", \"BAR83\")\n#          IID1  IID2  SNPS     R.GRM R.ped\n# 2617164 OAT90 BAR83 37279 0.4365756   0.5\n\n# all have good call rate... not sure what's going on.\n\n\nGet(\"MAR89\")  # OK, r=0.42 with mother MAW83\n\n\n\n#==========================\n\n# MGMS : 2698 pairs\n\nMums <- with(tblLife, tblLife[which(Code %in% Rel.id[,2] & MumCode %in% Rel.id[,2]),\n                              c(\"Code\", \"MumCode\")])\nMums <- merge(Mums, setNames(Rel.snp[, c(1,2,4)], c(\"Code\", \"MumCode\", \"R.grm\")),\n                all.x=TRUE)\nMums <- Merge(Mums, setNames(Rel.snp[, c(2,1,4)], c(\"Code\", \"MumCode\", \"R.grm\")),\n                by=c(\"Code\", \"MumCode\"), all.x=TRUE)  # 2299 pairs\n\nisnum <- function(x) !is.na(as.numeric(x))\n\nSibs <- with(Rel.snp, Rel.snp[substr(IID1,1,3)==substr(IID2,1,3) &\n                                isnum(substr(IID1,4,5)) & isnum(substr(IID2,4,5)) &\n                                !substr(IID1,1,3) %in% c(\"DSA\", \"UHA\") &\n                                !substr(IID1,6,7) %in% c(\"_X\",\"_Q\") &\n                                !substr(IID2,6,7) %in% c(\"_X\",\"_Q\"), ])  # 6468 pairs\nchk <- Sibs[Sibs$R.GRM < .1, ]\n\nMumSib <- with(tblLife, tblLife[which(Code %in% Rel.id[,2] & MumCode %in% Rel.id[,2]),\n                              c(\"Code\", \"MumCode\")])\nMumSib <- merge(MumSib, setNames(Sibs[,1:2], c(\"MumCode\", \"SibMum\")), all.x=TRUE)\nMumSib <- Merge(MumSib, setNames(Sibs[,2:1], c(\"MumCode\", \"SibMum\")), all.x=TRUE,\n                by=\"MumCode\")\nMumSib <- merge(MumSib, setNames(Rel.snp[, c(1,2,4)], c(\"Code\", \"SibMum\", \"R.grm\")),\n                all.x=TRUE)\nMumSib <- Merge(MumSib, setNames(Rel.snp[, c(2,1,4)], c(\"Code\", \"SibMum\", \"R.grm\")),\n                by=c(\"Code\", \"SibMum\"), all.x=TRUE)\nMumSib <- MumSib[!is.na(MumSib$R.grm), ]\nMumSib <- MumSib[MumSib$R.grm>0, ]  # 17116 pairs\n\nchk <- MumSib[MumSib$R.grm >0.4, ]\n\nU <- with(Rel.snp, Rel.snp[substr(IID1,1,3)!=substr(IID2,1,3),])\n\n\npdf(\"06-Output/hist4_Rgrm.pdf\", height=7, width=5)\npar(mfcol=c(5,1), mai=c(.4,.5,.2,.1), omi=c(.4,0,0,0))\nhist(Mums$R.grm, breaks=seq(0,.82,.005), col=grey(.3), border=NA,\n     xlim=c(0, 0.7), main=\"Mother\", xlab=\"\", ylab=\"\")\nhist(Sibs$R.GRM, breaks=seq(-.01,.82,.005), col=grey(.3), border=NA,\n     xlim=c(0, 0.7), main=\"Maternal sibling\", xlab=\"\", ylab=\"\")\nhist(MGMS$R.mgm, breaks=seq(-.01,.82,.005), col=grey(.3), border=NA,\n     xlim=c(0, 0.7), main=\"Maternal grandmother\", xlab=\"\", ylab=\"\")\nhist(MumSib$R.grm, breaks=seq(-.01,.82,.005), col=grey(.3), border=NA,\n     xlim=c(0, 0.7), main=\"Sibling of Mother\", xlab=\"\", ylab=\"\")\nhist(U$R.GRM[1:1e5], breaks=seq(-.15,.82,.005), col=grey(.3), border=NA,\n     xlim=c(0, 0.7), main=\"Others\", xlab=\"\", ylab=\"\")\nmtext(\"Genomic relatedness Rgrm\", side=1, line=3, cex=.8)\ndev.off()\n\n",
    "created" : 1525256213289.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "80284920",
    "id" : "3271FE11",
    "lastKnownWriteTime" : 1525704516,
    "last_content_update" : 1525704516465,
    "path" : "E:/SNP data/combine_QC/99_Scripts/Deer_Pedigree.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}