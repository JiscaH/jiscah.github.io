{
    "collab_server" : "",
    "contents" : "# consider:\n# AR, ER\n# time\n# Parent LLR\n\n\nlibrary(sequoia)\nsetwd(\"E:/Sequoia/test/test_simdata\")\n\nPed_deer <- read.table(\"Ped_2k.txt\", header=T, stringsAsFactors=F)\nLH_deer <- read.table(\"CodeSexBY.txt\", header=T, stringsAsFactors=F)\n# PedSize:  1642 (max AR dams), 1202 (max AR sires), 1998 (total possible errors)\n\nCntA <- array(dim=c(10,7,5,2))\nTimeM <- rep(NA, 10)\n\nfor (LL in c(400, 200)) {\n  cat(\"\\n\\n LL: \", LL, \"\\n\")\n  for (x in 1:10) {\n    cat(x, \"\\t\", format(Sys.time(), \"%H:%M:%S\"), \"\\n\")\n    GM <- SimGeno(Ped = Ped_deer, nSnp = LL, ParMis=0.4, SnpError = 1e-4)\n#    write.table(GM, paste0(\"2020-03/deer_GMs/GM_b\",x,\".txt\"), col.names=FALSE)  # TEMP! crash-test\n\n    TimeM[x] <- system.time(SeqOUT <- sequoia(GenoM = GM,  LifeHistData = LH_deer,\n                                              Tassign=0.5, Err=1e-4, MaxSibIter=10,\n                                              quiet=TRUE, UseAge=\"extra\"))[\"elapsed\"]  # , Plot=FALSE\n    PCC <- PedCompare(Ped1=Ped_deer, Ped2=SeqOUT$Pedigree)$Counts\n    CntA[x,,,] <- PCC\n\n    cat(\"AR: \", PCC[\"TT\",\"Match\",], \"\\t\",\n        \"ER: \", apply(PCC[\"TT\",c(\"Mismatch\",\"P2only\"), ], 2, sum), \"\\n\",\n        \"Min LLR: \", apply(SeqOUT$Pedigree[,4:6], 2, min, na.rm=TRUE), \"\\n\")\n#    if (LL==400 & sum(PCC[\"TT\", c(\"Mismatch\", \"P2only\"), ]) > 5)  break\n#    if (LL==200 & sum(PCC[\"TT\", c(\"Mismatch\", \"P2only\"), ]) > 10)  break\n#    if (min(SeqOUT$Pedigree[,6], na.rm=TRUE) < -10)  break\n  }\n  save(CntA, TimeM, file=paste0(\"Output-v1.3.42/Ped_deer_L\",LL,\"_Age-extra_1E4.RData\"))\n}\n\n\n\nPC <- PedCompare(Ped1=Ped_deer, Ped2=SeqOUT$Pedigree)\n\n\nParOUT <- sequoia(GenoM = GM,  LifeHistData = LH_deer,\n                                              Tassign=0.5, Err=1e-3, MaxSibIter=0,\n                                              CalcLLR=FALSE, Plot=FALSE)\nPed.A <- CalcOHLLR(ParOUT$PedigreePar, GM)\nSummarySeq(Ped.A, Panels=\"LLR\")\n# Pedigree column names not recognized. Must be id - dam - sire\n\nwriteSeq(ParOUT, GM, folder=\"2020-03/Ped_deer_s\")\n\nParS <- read.table(\"2020-03/Ped_deer_s/Parents - copy.txt\", header=T)\nSummarySeq(ParS, Panels=\"LLR\")\nhist(ParS$LLRdam[ParS$LLRdam < 999], breaks=100, col=\"grey\")\n\n\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# parentage speed: much slower than in MS?\n\nGM <- SimGeno(Ped = Ped_deer, nSnp = 200, ParMis=0.4, SnpError = 1e-4)\nsystem.time(ParOUT <- sequoia(GenoM = GM,  LifeHistData = LH_deer,\n                              Tassign=0.5, Err=1e-4, MaxSibIter=0,\n                              CalcLLR=FALSE, Plot=FALSE))\n #   user  system elapsed\n # 108.86    0.28  109.48\n\n# was: 15-20s\n\nwriteSeq(ParOUT, GM, folder=\"2020-05/Ped_deer_a\")\n# -02 vs -O3 ?\n\n# SA: 19.5 sec\n\n# now: R suddenly 25-26 sec.  ???.\n\n\n#~~~~~~~~~~~~~~~~~~\n#           dam sire\n# Total    1642 1202\n# Match    1430 1129\n# Mismatch    1    2\n# P1only    211   71\n# P2only      0    0\n\nPC$Mismatch[, 1:8]\n#        id dam.1 sire.1 dam.2 sire.2  id.r dam.r  sire.r\n# 607 F0099 STI96  BSY02 RUM99  BSY02 RUM09  <NA>    <NA>  # STI96 is GGM. not OK.\n# 877 KAR02 TKN94  D0279 F0052  M0046 KAR02 TKN94 nomatch  # OK, D0279 sex=3\n# 878 KAR03 TKN94  D0279 F0052  M0046 KAR03 TKN94 nomatch\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_r\")\n\nPedS <- read.table(\"2020-03/Ped_deer_r/Pedigree_round04.txt\", header=T)\nPCS <- PedCompare(Ped_deer, PedS)\nPCS$Counts[\"TT\",,]\n# Fixed.\n\n\n#~~~~~~~~~~~~~~~~~~\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1235 1109  << VERY low. Due to new checkCurPar threshold?\n# Mismatch    0    0\n# P1only    407   93\n# P2only      0    0\n\nSeqOUT$Pedigree[which(SeqOUT$Pedigree$LLRpair < 0), ]\n#         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire MEpair\n# 1813 F0077 F0007 M0002      0       0   -7.39    NA     NA     NA\n\n# F0077: ALLxx (PUF06). F0007: PUFxx (POM97). F0077 has 2 FS.\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_q\")\n\nPedS <- read.table(\"2020-03/Ped_deer_q/Pedigree_seq.txt\", header=T)\nPCS <- PedCompare(Ped_deer, PedS)\nPCS$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1463 1126\n# Mismatch    0    0\n# P1only    179   76\n# P2only      0    0\n\n\nPedS[which(PedS$LLRpair < 0), 1:8]\n#         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire\n# 1806 F0070 F0007 M0002      0       0   -8.62    -9     -9\n\n\n\n#~~~~~~~~~~~~~~~~~~\nSeqOUT$Pedigree[which(SeqOUT$Pedigree$LLRpair < 0), ]\n#         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire MEpair\n# 1156 HOC11 F0034 M0011   5.45    8.75  -55.41    NA     NA     NA\n# 1175 LCH10 F0070 KAR02   3.17  -21.01   -1.06    NA      0     NA\n\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1446 1118\n# Mismatch    0    2  # KAR02 & KAR03, dummy not replaced.\n# P1only    196   82\n# P2only      0    0\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_p\")\n\n# HOC11: unresolved, complicated case for pairUA.\n\n\n\n\n#~~~~~~~~~~~~~~~~~~\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1644 1204\n# Match    1475 1142\n# Mismatch    2    0\n# P1only    165   60\n# P2only      2    2\n\n\nPC$Mismatch[, 1:8]\n#         id dam.1 sire.1 dam.2 sire.2  id.r   dam.r sire.r\n# 1423 RDD10 CLK04  PERCY F0110  M0012 RDD10 nomatch  PERCY  >> FIXED\n# 1803 VIP14 VES06  RUM04 F0113  M0014 VIP14 nomatch  RUM04  >> unfixable.\nPC$P2only\n#        id dam.1 sire.1 dam.2 sire.2    id.r dam.r sire.r id.cat dam.cat sire.cat dam.class sire.class\n# 631 F0110  <NA>   <NA> GRA99  M0012 nomatch  <NA>  PERCY      X       X        X    P2only     P2only\n# 634 F0113  <NA>   <NA> NET02  CEDRI nomatch  <NA>   <NA>      X       X        X    P2only     P2only\n\n# 2x failed to merge --> TODO fix.\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_o\")\n\n\n\n#~~~~~~~~~~~~~~~~~~\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1454 1135\n# Mismatch    0    0\n# P1only    188   67\n# P2only      0    0\n\nSeqOUT$Pedigree[which(SeqOUT$Pedigree$LLRpair < 0), ]\n#         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire MEpair\n# 1797 F0061 SEQ96 M0029   2.59    3.61   -2.18    NA     NA     NA\n\n# F61 = YOGxx (YOS01), FS of YOS03 [884]  --> TODO FIX\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_n\")\n# OK, fixed (DummyGP CatB - not fixed underlying problem w catB)\n\n\n\n\n#~~~~~~~~~~~~~~~~~~\nPC$MergedPed[which(PC$MergedPed$dam.1 == \"GKG07\"), ]\n#      id dam.1 sire.1 dam.2 sire.2  id.r   dam.r sire.r id.cat dam.cat sire.cat dam.class sire.class\n# 8 ACA10 GKG07  D0276 F0100  D0276 ACA10   GKG07   <NA>      G       D        G     Match      Match\n# 9 ACA11 GKG07  WBEYS F0101  M0016 ACA11 nomatch  WBEYS      G       D        D  Mismatch      Match\n\n# sibships failed to merge. OK, just below threshold.\n\n\nSeqOUT$Pedigree[which(SeqOUT$Pedigree$LLRpair < 0), ]\n#         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire MEpair\n# 681  ROM02 F0091 M0014   1.00    7.77   -9.92    NA     NA     NA  <<\n# 1665 SIG08 RPP03 M0047  21.71    0.00   -0.15     1     NA     NA\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_m\")\nPedS <- read.table(\"2020-03/Ped_deer_m/Pedigree_seq.txt\", header=T)\nPCS <- PedCompare(Ped_deer, PedS)\nPCS$Counts[\"TT\",,]\n# OK. ROM02 unchanged.\n\n\n#~~~~~~~~~~~~~~~~~~\n# 2020-04-16, L200\n\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1207\n# Match    1421 1125\n# Mismatch    1    1\n# P1only    220   76\n# P2only      0    5\n\nPC$P2only[,1:8]\n#         id dam.1 sire.1 dam.2 sire.2    id.r dam.r  sire.r\n# 208  CAM15 MNM07   <NA> MNM07  M0055   CAM15  <NA> nomatch\n# 1027 M0055  <NA>   <NA>  <NA>  RUM06 nomatch  <NA>    <NA>  # GGpair. unfixable.\n\n# 928  LIA13 ARA09   <NA> ARA09  M0046   LIA13  <NA> nomatch  # unfixable.\n# 1757 UKL13 FDL99   <NA> FDL99  M0046   UKL13  <NA> nomatch  # wrong pair, no GP\n\n# 1458 RUM12 STI96   <NA> F0052  MOU05   RUM12 STI96    <NA>  # ass FS i.o. HS of RUM13\n# fixed.\n\nPC$Mismatch[,1:8]\n#        id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r\n# 284 CHK13 SOX04   <NA> F0034   <NA> CHK13 CHK07   <NA>  # OK, inbred exception\n# 548 F0034 SOX04  UKL05  <NA>  CLT95 CHK07  <NA>   <NA>\n\nPC$MergedPed[which(PC$MergedPed$dam.2 == \"F0034\"), 1:8]\n#        id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r\n# 284 CHK13 SOX04   <NA> F0034   <NA> CHK13 CHK07   <NA>\n# 302 CHY12 CHK07  KAR02 F0034  KAR02 CHY12 CHK07   <NA>\n# 303 CHY14 CHK07  FRT03 F0034  FRT03 CHY14 CHK07   <NA>\n\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_l\")\n\nPedS <- read.table(\"2020-03/Ped_deer_l/Pedigree_seq.txt\", header=T)\nPCS <- PedCompare(Ped_deer, PedS)\nPCS$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1206\n# Match    1421 1123\n# Mismatch    2    1  # worse.\n# P1only    219   78\n# P2only      0    4\n\nPCS$Mismatch[,1:8]\n#         id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r\n# 284  CHK13 SOX04   <NA> F0035   <NA> CHK13 CHK07   <NA>\n# 549  F0035 SOX04  UKL05  <NA>  CLT95 CHK07  <NA>   <NA>\n# 1524 SHL01 GRA96  D0284 SAX99   <NA> SHL01  <NA>   <NA>  # is PHS. >> fixed.\n\n\n\n\n#~~~~~~~~~~~~\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1643 1202\n# Match    1469 1134\n# Mismatch    3    0\n# P1only    170   68\n# P2only      1    0\nPC$Mismatch\n#         id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r Cat Parent\n# 1021 ACA11 GKG07  WBEYS F0090  WBEYS ACA11 CED04   <NA>  GD    dam  # chkpair - unfixable\n# 1351 SOP15 WLK11   <NA> F0112   <NA> SOP15 SLL07   <NA>  GD    dam  # chkadd?\n# 1813 F0103 TUR85  SAF88 OXA99   <NA> MAS99  <NA>   <NA>  DG    dam  # ggpair\nPC$P2only\n#         id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r Cat Parent\n# 1311 SEQ95  <NA>   <NA> F0091   <NA> SEQ95 CED99   <NA>  GD    dam  # GP as sib - fixed.\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_k\")\n\nPedS <- read.table(\"2020-03/Ped_deer_k/Pedigree_seq.txt\", header=T)\nPCS <- PedCompare(Ped_deer, PedS)\nPCS$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1466 1135\n# Mismatch    4    0\n# P1only    172   67\n# P2only      0    0\n\nPCS$Mismatch\n#         id dam.1 sire.1 dam.2 sire.2  id.r   dam.r sire.r Cat Parent\n# 830  GKG10 CED04  RUSTY F0084  RUSTY GKG10 nomatch   <NA>  GD    dam\n# 1021 ACA11 GKG07  WBEYS F0084  WBEYS ACA11 nomatch   <NA>  GD    dam\n# 1352 SOP15 WLK11   <NA> F0111   <NA> SOP15   SLL07   <NA>  GD    dam  # R4 - right on TA. unfixable.\n# 1814 F0101 TUR85  SAF88 OXA99   <NA> MAS99    <NA>   <NA>  DG    dam  # GGpair: BHN04 [946], OXA99 is PHS of MAS99\n\n\nPCS$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1465 1135\n# Mismatch    3    0  # as good as it gets\n# P1only    174   67\n# P2only      0    0\n\n\n\n#~~~~~~~~~~~~\nSeqOUT$Pedigree[which(SeqOUT$Pedigree$LLRpair < 0), ]\n#         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire MEpair\n# 1850 F0114 F0054 ALD99  -0.47    6.93   -2.20    NA     NA     NA\n# 1900 M0050 FDL99 CLT95   1.54  -15.07  -11.08    NA     NA     NA\n\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1643 1202\n# Match    1480 1136\n# Mismatch    1    0\n# P1only    161   66\n# P2only      1    0\n\nPC$Mismatch\n#         id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r Cat Parent\n# 1738 F0114 DTN04  ALD99 F0054  ALD99 CCK07 TRT05   <NA>  DD    dam\n\nPC$P2only\n#         id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r Cat Parent\n# 1171 CLT95  <NA>   <NA> F0090   <NA> CLT95 SOX04   <NA>  GD    dam  # GP assigned as sib\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_j\")\n\nPedS <- read.table(\"2020-03/Ped_deer_j/Pedigree_seq.txt\", header=T)\nPCS <- PedCompare(Ped_deer, PedS)\nPCS$Counts[\"TT\",,]\n\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-04-13\nSeqOUT$Pedigree[which(SeqOUT$Pedigree$LLRpair < 0), ]\n#         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire MEpair\n# 1512 BCA14 F0090 LAPHR -10.38    7.80  -14.74    NA      0     NA\n# 1826 F0090 CUC91 KKONG   2.44   -1.01   -4.39    NA     NA     NA\n\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1475 1130\n# Mismatch    1    0\n# P1only    166   72\n# P2only      0    0\n\nPC$Mismatch\n#        id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r Cat Parent\n# 344 BCA14 CBS09  LAPHR F0090  LAPHR BCA14 ZUC03   <NA>  GD    dam\n\nPC$MergedPed[which(PC$MergedPed$dam.2 == \"F0090\"), ]\n#         id dam.1 sire.1 dam.2 sire.2 id.r dam.r sire.r\n# 344  BCA14 CBS09  LAPHR F0090  LAPHR <NA> ZUC03   <NA>\n# 359  CBS11 ZUC03  TNG97 F0090  M0002 <NA> ZUC03  TNG97\n# 877  CBS13 ZUC03  SPD01 F0090  SPD01 <NA> ZUC03   <NA>\n# 1266 CBS15 ZUC03   <NA> F0090   <NA> <NA> ZUC03   <NA>\n\n# CBS09 = ZUC03 x PERCY\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_i\")\n# BCA14 - CBS13 assigned as pair - unavoidable.\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-04-12, L400\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1643 1203\n# Match    1431 1143\n# Mismatch    4    0\n# P1only    207   59\n# P2only      1    1\n\nPC$Mismatch\n#        id dam.1 sire.1 dam.2 sire.2  id.r   dam.r sire.r Cat Parent\n# 284 VES07 NET02  CEDRI F0015  M0001 VES07 nomatch  CEDRI  GD    dam\n# 285 NET06 DOC94  CEDRI F0015  M0001 NET06 nomatch  CEDRI  GD    dam\n# 292 NET07 DOC94  CEDRI F0015  M0001 NET07 nomatch  CEDRI  GD    dam\n# 300 VES08 NET02  CEDRI F0015  M0001 VES08 nomatch  CEDRI  GD    dam\n\n# erroneous merging of 2 mat sibships\n# same sire causing problem --> structural issue.\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_g\")\n\n# At line 12021 of file ../Sequoia_SA.f90\n# Fortran runtime error: Index '56' of dimension 2 of array 'byo' outside of expected range (55:1)\n# D0284 / ACA10 wrong way around -- OK by SA.\n\nPedS <- read.table(\"2020-03/Ped_deer_g/Pedigree_seq.txt\", header=T)\nPCS <- PedCompare(Ped_deer, PedS)\nPCS$Counts[\"TT\",,]\n#           dam sire\n# Total    1643 1203\n# Match    1431 1143\n# Mismatch    4    0\n# P1only    207   59\n# P2only      1    1\n\n# >> fixed\nPCS$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1435 1142\n# Mismatch    0    0\n# P1only    207   60\n# P2only      0    0\n\n\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-04-11, L400\n\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1643 1202\n# Match    1449 1110\n# Mismatch    1    4\n# P1only    192   88\n# P2only      1    0\n\nPC$Mismatch\n#         id dam.1 sire.1 dam.2 sire.2  id.r dam.r  sire.r Cat Parent\n# 634  JEE00 HAL90  D0284 F0062  M0041 JEE00 HAL90 nomatch  GG   sire\n# 635  MDL99 FAN93  D0284 F0060  M0041 MDL99 FAN93 nomatch  GG   sire\n# 1776 F0056 TAM93  D0284 TAM93  M0041 SAX99  <NA> nomatch  DG   sire\n\n# 1763 M0044 WAL02  CEDRI F0005  M0006 PCN06 WAL03   CEDRI  DG    dam  # singleton, ABS11 [1487]\n# 1757 F0085 NET02  CEDRI  <NA>  M0005 VES06  <NA>   OCH92  DD   sire  # M5 is MGF of VES06; GGP of F85\n\n# > dummy M41 not replaced by unknown-age D0284\n# > wrong GP (2x) M44 should be WAL02 [834] x M6,  F85: should be F57 x M6\n\nPC$P2only\n#         id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r Cat Parent\n# 1585 D0284  <NA>   <NA> SHL01   <NA> D0284  <NA>   <NA>  GG    dam\n# primary or secondary problem?  >> FIXED.\n\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_f\")\n\nPedS <- read.table(\"2020-03/Ped_deer_f/Pedigree_seq.txt\", header=T)\nPCS <- PedCompare(Ped_deer, PedS)\nPCS$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1451 1114\n# Mismatch    1    0\n# P1only    190   88\n# P2only      0    0\n\n# good enough. last one seems unfixable (dummyGP and/or pairUA problem for checkmerge)\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-04-11, L200, E=1e-3, 4x:\n# AR = 0.9117, ER=0.000125, time=1424s\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-04-10, L400, E=1e-3\n\n# AR:  1470 1143 \t ER:  0 1\n#  Min LLR:  -20.98 -95.38 -104.67\n# (no break, problem unclear)\n\n# AR:  1464 1116 \t ER:  0 0\n#  Min LLR:  -16.09 -1.44 -10.21\n\nSeqOUT$Pedigree[which(SeqOUT$Pedigree$LLRpair < 0), ]\n#         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire MEpair\n# 276  CAY03 F0053 M0035   0.00    0.00   -6.31    NA     NA     NA\n# 277  CAY04 F0053 M0035   0.00    0.00   -3.77    NA     NA     NA\n# 478  KAR02 F0074 D0279  -6.04    6.26   -0.10    NA      0     NA\n# 992  CHM10 F0047 M0010  10.23    9.74   -0.04    NA     NA     NA\n# 993  CHM12 F0047 FLG00   7.76   11.26   -7.16    NA      0     NA\n# 995  CHM14 F0047 FLG00   8.58   10.13  -10.21    NA      0     NA  <<\n# 1751 F0015 CRM01 M0014   2.50   -0.94   -0.45    NA     NA     NA\n\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_e\")\n\nPed <- read.table(\"2020-03/Ped_deer_e/Pedigree_seq.txt\", header=T)\nPCS <- PedCompare(Ped_deer, Ped)\nPCS$Counts[\"TT\",,]  # unchanged, OK\n\nSummarySeq(Ped, Panels=\"LLR\")\nPed[which(Ped$LLRpair < 0), ]\n#         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire MEpair RowO RowD RowS Sex\n# 276  CAY03 F0053 M0034   0.00    0.00   -6.05    -9     -9     -9  276  -53  -34   2  TODO\n# 277  CAY04 F0053 M0034   0.00    0.00   -1.97    -9     -9     -9  277  -53  -34   2\n# 478  KAR02 F0074 D0279  -6.04    6.26   -0.10    -9      0     -9  478  -74  203   2  # OK\n# 1751 F0015 CRM01 M0014   2.50   -0.94   -0.45    -9     -9     -9  -15  335  -14   1  # OK\n\n# CAY: FS pair, no GPs, no HS\n# >> fixed.\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-04-01, L=200, E=1e-4, 4x\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)   # 0.881\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.0023\nmean(TimeM, na.rm=TRUE)  # 2130s\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-04-01, L=400, E=1e-3 (?), 10x\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)   # 0.898\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.000325\nmean(TimeM, na.rm=TRUE)  # 1625s\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-04-01, LL400, E=1e-3\nwriteSeq(SeqOUT, GM, folder=\"2020-03/Ped_deer_d\")\n\nPC <- PedCompare(Ped1=Ped_deer, Ped2=SeqOUT$Pedigree)\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1644 1204\n# Match    1467 1124\n# Mismatch    2    0\n# P1only    173   78\n# P2only      2    2\n\nPC$Mismatch\n#        id dam.1 sire.1 dam.2 sire.2  id.r   dam.r sire.r Cat Parent\n# 255 LYR14 LUT08  HEL05 F0105  HEL05 LYR14 nomatch   <NA>  GD    dam\n# 760 LYR12 LUT08  MOU05 F0104  MOU05 LYR12 nomatch   <NA>  GD    dam\n\nPC$P2only\n#          id dam.1 sire.1 dam.2 sire.2    id.r dam.r sire.r Cat Parent\n# 1897  F0104  <NA>   <NA> FDL03  NIGEL nomatch  <NA>   <NA>  TT    dam + sire\n# 1898  F0105  <NA>   <NA> FDL03  NIGEL nomatch  <NA>   <NA>  TT    dam + sire\n\nPC$MergedPed[which(PC$MergedPed$dam.1==\"LUT08\"), ]\n#        id dam.1 sire.1 dam.2 sire.2 id.r   dam.r sire.r\n# 255 LYR14 LUT08  HEL05 F0105  HEL05 <NA> nomatch   <NA>\n# 760 LYR12 LUT08  MOU05 F0104  MOU05 <NA> nomatch   <NA>\n\n# TODO PedCompare: either one should have been counted as OK match\n\n# >> OK, prob. not MHS due to genotyping errors.\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-03-31, L400, E=1e-4\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)   # 0.9083\nmin(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)    # 0.9015\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.000111\nmax(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)   # 0.0005005\nmean(TimeM, na.rm=TRUE)  # 1543.6\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-03-31, L400, E=1e-4\n\nPed <- read.table(\"2020-03/Ped_deer_c/Pedigree_seq.txt\", header=T)\nPC <- PedCompare(Ped_deer, Ped)\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1643 1203\n# Match    1455 1133  # AR=0.910\n# Mismatch    3    1\n# P1only    184   68\n# P2only      1    1\n\nPC$Mismatch\n#          id dam.1 sire.1 dam.2 sire.2  id.r   dam.r sire.r Cat Parent\n# 441   RDD10 CLK04  PERCY F0021  M0008 RDD10 nomatch  PERCY  GD    dam\n# 446   RDD08 CLK04  PERCY F0021  M0008 RDD08 nomatch  PERCY  GD    dam  # failed to merge; inbred\n# 1778  F0108 DTN04  ALD99 F0009  M0015 CCK07   SUR87  FRA96  DD    dam  # wrong GPs\n# 17781 F0108 DTN04  ALD99 F0009  M0015 CCK07   SUR87  FRA96  DG   sire\n\nPC$P2only\n# F0021: correct GPs.\n\n#>> fixed!\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1642 1202\n# Match    1458 1135\n# Mismatch    0    0\n# P1only    184   67\n# P2only      0    0\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 2020-03-30, L200, E=1e-3  (Ped_deer_b)\nPC <- PedCompare(Ped1=Ped_deer, Ped2=SeqOUT$Pedigree)\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1643 1206\n# Match    1424 1111\n# Mismatch    2    3\n# P1only    216   88\n# P2only      1    4  # ER=0.00225\n\nPC$Mismatch\n#         id dam.1 sire.1 dam.2 sire.2  id.r   dam.r  sire.r Cat Parent\n# 263  HON02 SUN93  KID90 F0079  KID90 HON02 nomatch    <NA>  GD    dam  # failed to merge\n# 618  HON99 SUN93  TURKS F0079  M0034 HON99 nomatch   TURKS  GD    dam\n# 627  LMS01 GOD94  HARRY GOD94  M0037 LMS01    <NA> nomatch  GD   sire  # failed to merge\n# 628  MNN05 MINNI  HARRY MINNI  M0037 MNN05    <NA> nomatch  GD   sire\n# 1751 F0102 MNS03  AIDAN MNS03  LAR06 TSU10    <NA>    <NA>  DG   sire  # PHS assigned as sire\n\n\nPC$P2only\n#          id dam.1 sire.1 dam.2 sire.2    id.r dam.r  sire.r Cat Parent\n# 672   LEI15 RAP06   <NA> RAP06  M0048   LEI15  <NA> nomatch  GD   sire  # false GP pair\n# 1890  M0048  <NA>   <NA> GEN03  JEE00 nomatch  <NA>    <NA>  TT    dam\n# 18901 M0048  <NA>   <NA> GEN03  JEE00 nomatch  <NA>    <NA>  TT   sire\n\n# 675   SOA15 BRY10   <NA> BRY10  M0051   SOA15  <NA> nomatch  GD   sire  # false GP pair\n# 1892  M0051  <NA>   <NA>  <NA>  FRA01 nomatch  <NA>    <NA>  TT   sire\n\n\n\nPCP <- PedCompare(Ped1=Ped_deer, Ped2=SeqOUT$PedigreePar)\nPCP$Counts[\"GG\",,]\nhead(PCP$P1only)\n#        id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r Cat Parent\n# 282 CHM10 HOC05  AIDAN  <NA>   <NA> CHM10    NA     NA  GG    dam  [995] = [440] x _\n# 469 DRN00 DORNY   <NA>  <NA>   <NA> DRN00    NA     NA  GG    dam\n# 850 LPA08 LMS97  PERRN  <NA>   <NA> LPA08    NA     NA  GG    dam\n# 852 LPA11 LMS97   <NA>  <NA>   <NA> LPA11    NA     NA  GG    dam\n# 912 MEG09 MAR95  AIDAN  <NA>   <NA> MEG09    NA     NA  GG    dam\n# 949 MNM09 CHN03  TNG97  <NA>   <NA> MNM09    NA     NA  GG    dam\n\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n# 27/02/2020, L200, 6x\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)    # 0.8798\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.00323\nmean(TimeM, na.rm=TRUE)  # 1856.5\n\n# 21/01/2020, L400, 5x\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)   # 0.8904\nmin(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)    # 0.8780\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.000350\nmax(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)   # 0.0005005\nmean(TimeM, na.rm=TRUE)   # 1341.7\n\n\n# 24/01/2020, L400, 5x\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)    # 0.876\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.0041\nmean(TimeM, na.rm=TRUE)  # 1570.3\n\n# 25/01/2020, L200, 10x\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)    # 0.8866\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.00065\nmean(TimeM, na.rm=TRUE)  # 1935.9\n\n\n# 24/5/2019, L200, 5x\nmean(apply(CntA[2,,7,2,],1,sum)/(1642+1202), na.rm=T)  # 0.8724   (was: 0.861)\nmean(apply(CntA[2,,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.00225  (was: 1.48E-3)\napply(TimeM, 1, mean, na.rm=T)   # 17.04857 3002.41000\n\n# 6/6/2019, L400, 8x\nmean(apply(CntA[2,,7,2,],1,sum)/(1642+1202), na.rm=T)  # 0.896\nmean(apply(CntA[2,,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 4.69E-4\napply(TimeM[,-3], 1, mean, na.rm=T)  # 41.98 4579.98\n\n\n# 14/6, L400, 6x, extra age\nmean(apply(CntA[2,,7,2,],1,sum)/(1642+1202), na.rm=T)  # 0.9305\nmean(apply(CntA[2,,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 3.337E-4\napply(TimeM, 1, mean, na.rm=T)\n\n# 14/16, L200, extra age\n# stopped after 2x when hit ER=15+15 = 0.008  (still fine actually)\n\n\n\n\n#~~~~~~~~~~~~~~~~~\n# 17/6, L200, yes age, 6x\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)  # 0.86246\nmin(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)   # 0.8407\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.003128\nmax(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)   # 0.006256\nmean(TimeM, na.rm=TRUE)   #  4907\n\n#~~~~~~~~~~~~~~~~~\n# 17/6, L400, yes age, 7x\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)  # 0.8931585\nmin(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)   # 0.8677918\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.0002860003\nmax(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)   # 0.001001001\nmean(TimeM, na.rm=TRUE)  # 4419.559\n\n#~~~~~~~~~~~~~~~~~\n# 17/6, L200, extra age, 3x\nmean(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)  # 0.9017815\nmin(apply(CntA[,7,2,],1,sum)/(1642+1202), na.rm=T)   # 0.8959212\nmean(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)  # 0.00333667\nmax(apply(CntA[,7,c(3,5),],1,sum)/(2*1998), na.rm=T)   # 0.004754755\nmean(TimeM, na.rm=TRUE)   # 10851.54\n\n\n\n\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nPed.R3 <- read.table(\"2020-02/deer2K/Pedigree_round03.txt\", header=T)\nPC <- PedCompare(Ped_deer, Ped.R3)\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1644 1208\n# Match    1363 1086\n# Mismatch    7    2\n# P1only    272  114\n# P2only      2    6   OK, see test_agephase.R\n\n\nPed <- read.table(\"2020-02/deer2K/Pedigree_seq.txt\", header=T)\nPC <- PedCompare(Ped_deer, Ped)\nPC$Counts[\"TT\",,]\n#           dam sire\n# Total    1643 1207\n# Match    1365 1094\n# Mismatch    7    2\n# P1only    270  106\n# P2only      1    5\n\n# was:\n#           dam sire\n# Total    1644 1207\n# Match    1370 1098  --> why did AR drop? all due to GGpairs?\n# Mismatch    7    2\n# P1only    265  102\n# P2only      2    5\n\nPed.O <- read.table(\"2020-02/deer2K/Pedigree_round05 - 0202.txt\", header=T) # last R before ExtraAge\nPCO <- PedCompare(Ped_deer, Ped.O)\nPCO$Counts[\"TT\",,]\n#           dam sire\n# Total    1644 1207\n# Match    1370 1098\n# Mismatch    7    2\n# P1only    265  102\n# P2only      2    5\n\nPCX <- PedCompare(Ped.O, Ped)\nPCX$Counts[\"TT\",,]\n#           dam sire\n# Total    1379 1106\n# Match    1373 1100\n# Mismatch    0    0\n# P1only      6    5\n# P2only      0    1\n\nPCX$P2only\n#        id dam.1 sire.1 dam.2 sire.2  id.r dam.r sire.r Cat Parent\n# 890 D0282  <NA>   <NA>  <NA>  SAP08 D0282  <NA>   <NA>  GG   sire  # reversed.\n\nPCX$P1only\n #    id dam.1 sire.1 dam.2 sire.2\n # SAP15 F0017   <NA>  <NA>   <NA>\n # SAP06 F0017   <NA>  <NA>   <NA>\n # SAP09 F0017   <NA>  <NA>   <NA>\n # SAP08 F0017  D0282  <NA>   <NA>\n # F0017 STO98  HER91  <NA>   <NA>\n\n # LAV09 F0070  D0282 F0088   <NA>\n\n # FLU12 PCO06  M0054 PCO06   <NA>\n # M0054 TRT00   <NA>  <NA>   <NA>\n\n # M0007  <NA>  BASIL  <NA>   <NA>\n\n",
    "created" : 1588843889968.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "968824760",
    "id" : "9133CAFF",
    "lastKnownWriteTime" : 1588915348,
    "last_content_update" : 1588915348725,
    "path" : "E:/Sequoia/test/test_simdata/test_Ped3_2020-05-08.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}