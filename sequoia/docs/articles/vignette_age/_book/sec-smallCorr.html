<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Small sample correction | Sequoia - Age ‘Prior’</title>
  <meta name="description" content="6 Small sample correction | Sequoia - Age ‘Prior’" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Small sample correction | Sequoia - Age ‘Prior’" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/../../sequoia_logo.png" />
  
  <meta name="github-repo" content="JiscaH/sequoia" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Small sample correction | Sequoia - Age ‘Prior’" />
  
  
  <meta name="twitter:image" content="/../../sequoia_logo.png" />

<meta name="author" content="Jisca Huisman" />


<meta name="date" content="2021-02-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png" />
  <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon" />
<link rel="prev" href="pedigree-based-ageprior.html"/>
<link rel="next" href="sec-GP-AU.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./../../../index.html"><img src="../../home-solid-silver.svg" height="40" alt="home"/></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> In short</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#age-info-is-useful"><i class="fa fa-check"></i><b>1.1</b> Age Info is Useful</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#implementation"><i class="fa fa-check"></i><b>1.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#passing-the-threshold"><i class="fa fa-check"></i><b>1.2.1</b> Passing the threshold</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#time-units"><i class="fa fa-check"></i><b>1.3</b> Time units</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#runtime-messages"><i class="fa fa-check"></i><b>1.4</b> Runtime Messages</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#changing-the-ageprior"><i class="fa fa-check"></i><b>1.5</b> Changing the ageprior</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="maths.html"><a href="maths.html"><i class="fa fa-check"></i><b>2</b> Maths</a>
<ul>
<li class="chapter" data-level="2.1" data-path="maths.html"><a href="maths.html#ageprior"><i class="fa fa-check"></i><b>2.1</b> AgePrior</a></li>
<li class="chapter" data-level="2.2" data-path="maths.html"><a href="maths.html#sec:unsampled"><i class="fa fa-check"></i><b>2.2</b> Unsampled individuals</a></li>
<li class="chapter" data-level="2.3" data-path="maths.html"><a href="maths.html#genetics-times-age"><i class="fa fa-check"></i><b>2.3</b> Genetics <span class="math inline">\(\times\)</span> Age</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ageprior-matrix-explained.html"><a href="ageprior-matrix-explained.html"><i class="fa fa-check"></i><b>3</b> AgePrior matrix explained</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ageprior-matrix-explained.html"><a href="ageprior-matrix-explained.html#agepriorextra"><i class="fa fa-check"></i><b>3.1</b> <code>AgePriorExtra</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sec-Default.html"><a href="sec-Default.html"><i class="fa fa-check"></i><b>4</b> Default ageprior</a></li>
<li class="chapter" data-level="5" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html"><i class="fa fa-check"></i><b>5</b> Pedigree-based ageprior</a>
<ul>
<li class="chapter" data-level="5.1" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html#sec:Discrete"><i class="fa fa-check"></i><b>5.1</b> Discrete generations</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html#generation-interval-different-from-1"><i class="fa fa-check"></i><b>5.1.1</b> Generation interval different from 1</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html#sec:overlap"><i class="fa fa-check"></i><b>5.2</b> Overlapping generations</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html#birthyearrange"><i class="fa fa-check"></i><b>5.2.1</b> <code>BirthYearRange</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html#sec:MaxAgePO"><i class="fa fa-check"></i><b>5.2.2</b> <code>MaxAgeParent</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html#sec:tblAR"><i class="fa fa-check"></i><b>5.2.3</b> Counts: <code>tblA.R</code></a></li>
<li class="chapter" data-level="5.2.4" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html#par-pa.r"><i class="fa fa-check"></i><b>5.2.4</b> P(A|R): <code>PA.R</code></a></li>
<li class="chapter" data-level="5.2.5" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html#sec:FSuseHS"><i class="fa fa-check"></i><b>5.2.5</b> Full sibling correction</a></li>
<li class="chapter" data-level="5.2.6" data-path="pedigree-based-ageprior.html"><a href="pedigree-based-ageprior.html#sec:standardise"><i class="fa fa-check"></i><b>5.2.6</b> Ageprior P(A|R)/P(A): <code>LR.RU.A.raw</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sec-smallCorr.html"><a href="sec-smallCorr.html"><i class="fa fa-check"></i><b>6</b> Small sample correction</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec-smallCorr.html"><a href="sec-smallCorr.html#the-problem"><i class="fa fa-check"></i><b>6.1</b> The problem</a></li>
<li class="chapter" data-level="6.2" data-path="sec-smallCorr.html"><a href="sec-smallCorr.html#sec:Smooth"><i class="fa fa-check"></i><b>6.2</b> Smooth</a></li>
<li class="chapter" data-level="6.3" data-path="sec-smallCorr.html"><a href="sec-smallCorr.html#sec:Flatten"><i class="fa fa-check"></i><b>6.3</b> Flatten</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="sec-smallCorr.html"><a href="sec-smallCorr.html#weighing-factor-lambdanw"><i class="fa fa-check"></i><b>6.3.1</b> Weighing factor &amp; <code>lambdaNW</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="sec-smallCorr.html"><a href="sec-smallCorr.html#sample-size-vs.-sampling-probability"><i class="fa fa-check"></i><b>6.3.2</b> Sample size vs. sampling probability</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sec-GP-AU.html"><a href="sec-GP-AU.html"><i class="fa fa-check"></i><b>7</b> Grandparents &amp; Avuncular</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sec-GP-AU.html"><a href="sec-GP-AU.html#maths-1"><i class="fa fa-check"></i><b>7.1</b> Maths</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="sec-GP-AU.html"><a href="sec-GP-AU.html#ageprior-to-probability-to-ageprior"><i class="fa fa-check"></i><b>7.1.1</b> Ageprior to Probability to Ageprior</a></li>
<li class="chapter" data-level="7.1.2" data-path="sec-GP-AU.html"><a href="sec-GP-AU.html#change-from-v1.3-to-v2.0"><i class="fa fa-check"></i><b>7.1.2</b> change from v1.3 to v2.0</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sec-customAP.html"><a href="sec-customAP.html"><i class="fa fa-check"></i><b>8</b> Customise</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sec-customAP.html"><a href="sec-customAP.html#via-args.ap"><i class="fa fa-check"></i><b>8.1</b> Via <code>args.AP</code></a></li>
<li class="chapter" data-level="8.2" data-path="sec-customAP.html"><a href="sec-customAP.html#different-input-pedigree"><i class="fa fa-check"></i><b>8.2</b> Different input pedigree</a></li>
<li class="chapter" data-level="8.3" data-path="sec-customAP.html"><a href="sec-customAP.html#other-tweaks"><i class="fa fa-check"></i><b>8.3</b> Other tweaks</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="sec-customAP.html"><a href="sec-customAP.html#age-at-first-reproduction"><i class="fa fa-check"></i><b>8.3.1</b> Age at first reproduction</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="sec-customAP.html"><a href="sec-customAP.html#from-age-difference-distribution"><i class="fa fa-check"></i><b>8.4</b> From age-difference distribution</a></li>
<li class="chapter" data-level="8.5" data-path="sec-customAP.html"><a href="sec-customAP.html#specifications"><i class="fa fa-check"></i><b>8.5</b> Specifications</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
<li class="divider"></li>
<li><a href="./../../vignette_main/_book/sec-Background.html">Main Vignette</a></li>
<li><a href="./../../index.html">Other Manuals</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Sequoia - Age ‘Prior’</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec:smallCorr" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Small sample correction</h1>
<hr />
<p>Calculating the proportion of pairs with relationship <span class="math inline">\(R\)</span> and age difference <span class="math inline">\(A\)</span> in a pedigree is <a href="pedigree-based-ageprior.html#sec:overlap">reasonably straightforward</a>, but generating a matrix that is useful for subsequent pedigree reconstruction under a wide range of ‘non-ideal’ situations is not.</p>
<div id="the-problem" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> The problem</h2>
<p>A major challenge is that when an age/relationship combination is not observed in the input pedigree, its ageprior value will be <span class="math inline">\(0\)</span>, and without correction that age/relationship combination will be deemed impossible during full pedigree reconstruction. For example, if mother-offspring pairs with age differences of 1, 2, 3, and 5 years are observed, it would infer that females never breed at age 4. This seems highly unlikely from a biological perspective, and is much more likely a sampling artefact. This does matter during full pedigree reconstruction: if the true maternal grandmother is 8 years older than one of her grandchildren, she would not be assigned, because mothers cannot be age 4.</p>
<p>As another example, imagine that no candidate fathers at all were sampled. Based on the parentage-only scaffold pedigree, the counts in the father column of <code>tblA.R</code> would be <span class="math inline">\(0\)</span> for all age differences. Consequently, all age differences would be disallowed for father-offspring pairs during subsequent full pedigree reconstruction, including for dummy fathers, and no paternal sibships would be clustered.</p>
<p>Incorrect agepriors can also lead to false positives: when it is wrongly believed the age difference of a genetic half-sib pair makes it impossible for them to be maternal siblings, they will likely be assigned as paternal half-siblings. More individuals may then be added to this erroneous paternal sibship, potentially setting off a snowball effect of wrong assignments.</p>
<p>To minimise these problems, <code>MakeAgePrior()</code> applies two generic, one-size-fits-most corrections: a <code>Smooth</code>ing of dips and padding of the tails, and a <code>Flatten</code>ing approach whereby a weighed average of the pedigree-based and flat default ageprior is taken (Figure <a href="sec-smallCorr.html#fig:griffinSmoothFlatten">6.1</a>).</p>
<!--- TODO: ref to #sec:FSuseHS -->
<div class="figure"><span id="fig:griffinSmoothFlatten"></span>
<img src="figs/griffinSmoothFlatten-1.png" alt="Smoothed &amp; Flattened agepriors for overlapping generations (griffin example). Note the different y-axes; non-displayed age differences have an ageprior of zero for all R." width="768" />
<p class="caption">
Figure 6.1: Smoothed &amp; Flattened agepriors for overlapping generations (griffin example). Note the different y-axes; non-displayed age differences have an ageprior of zero for all R.
</p>
</div>
</div>
<div id="sec:Smooth" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Smooth</h2>
<p>When <code>Smooth=TRUE</code>, the tails of the distributions are ‘stretched’ and any dips are smoothed over. It defaults to <code>TRUE</code>, as there is only rarely a detrimental effect of smoothing when none is required. Exception is when generations are <a href="pedigree-based-ageprior.html#sec:Discrete">discrete</a>; when this is detected or declared by the user, <code>Smooth</code> is set to <code>FALSE</code> automatically.</p>
<p>A ‘dip’ is defined as a value that is less than 10% of the average of its neighbouring values (age differences of one year less/more), and both neighbours have values <span class="math inline">\(&gt;0\)</span>. It is then changed to the average of the two neighbours. Peaks are not smoothed out, as these are less likely to cause problems than dips, and are more likely to be genuine characteristics of the species.</p>
<p>The front &amp; end tails of the distribution are altered as follows:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="sec-smallCorr.html#cb47-1" aria-hidden="true" tabindex="-1"></a>SmoothAP <span class="ot">&lt;-</span> <span class="cf">function</span>(V, MinP) {</span>
<span id="cb47-2"><a href="sec-smallCorr.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  Front <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">min</span>(<span class="fu">which</span>(V <span class="sc">&gt;</span> MinP)), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-3"><a href="sec-smallCorr.html#cb47-3" aria-hidden="true" tabindex="-1"></a>  End <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">max</span>(<span class="fu">which</span>(V <span class="sc">&gt;</span> MinP)), <span class="fu">length</span>(V), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-4"><a href="sec-smallCorr.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (Front <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> V[Front] <span class="sc">&gt;</span> <span class="dv">3</span><span class="sc">*</span>MinP)    V[Front <span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> MinP</span>
<span id="cb47-5"><a href="sec-smallCorr.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (End <span class="sc">&lt;</span> <span class="fu">length</span>(V))                                V[End <span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> V[End]<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb47-6"><a href="sec-smallCorr.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((End<span class="sc">+</span><span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fu">length</span>(V) <span class="sc">&amp;</span> V[End<span class="sc">+</span><span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">3</span><span class="sc">*</span>MinP)  V[End<span class="sc">+</span><span class="dv">2</span>] <span class="ot">&lt;-</span> MinP</span>
<span id="cb47-7"><a href="sec-smallCorr.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ... dip-fixing ...</span></span>
<span id="cb47-8"><a href="sec-smallCorr.html#cb47-8" aria-hidden="true" tabindex="-1"></a>  V</span>
<span id="cb47-9"><a href="sec-smallCorr.html#cb47-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-10"><a href="sec-smallCorr.html#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="sec-smallCorr.html#cb47-11" aria-hidden="true" tabindex="-1"></a>LR.RU.A <span class="ot">&lt;-</span> <span class="fu">apply</span>(LR.RU.A, <span class="dv">2</span>, SmoothAP, <span class="at">MinP =</span> <span class="fl">0.001</span>)</span></code></pre></div>
<p>There is no way to change the behaviour of <code>Smooth</code>, except turning it on or off. If for example a longer tail is required at either end, or more thorough smoothing is needed, you will need to edit the ageprior matrix yourself (see <a href="sec-customAP.html#sec:customAP">Customisation</a>).</p>
</div>
<div id="sec:Flatten" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Flatten</h2>
<p>The ageprior is ‘flattened’ by taking a weighed average between the ageprior based on the pedigree and birth years, and a flat <a href="sec-Default.html#sec:Default">default ageprior</a> based on the maximum age of parents only (user-specified, pedigree-estimated, or maximum age difference in <code>LifeHistData</code>):</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="sec-smallCorr.html#cb48-1" aria-hidden="true" tabindex="-1"></a>AP.pedigree <span class="ot">&lt;-</span> <span class="fu">MakeAgePrior</span>(Ped_griffin, <span class="at">Smooth=</span><span class="cn">FALSE</span>, <span class="at">Flatten=</span><span class="cn">FALSE</span>, </span>
<span id="cb48-2"><a href="sec-smallCorr.html#cb48-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">quiet=</span><span class="cn">TRUE</span>, <span class="at">Plot=</span><span class="cn">FALSE</span>)</span>
<span id="cb48-3"><a href="sec-smallCorr.html#cb48-3" aria-hidden="true" tabindex="-1"></a>AP.default <span class="ot">&lt;-</span> <span class="fu">MakeAgePrior</span>(<span class="at">MaxAgeParent =</span> <span class="dv">3</span>, <span class="at">quiet=</span><span class="cn">TRUE</span>, <span class="at">Plot=</span><span class="cn">FALSE</span>)</span>
<span id="cb48-4"><a href="sec-smallCorr.html#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="sec-smallCorr.html#cb48-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">list</span>(AP.pedigree, AP.default), </span>
<span id="cb48-6"><a href="sec-smallCorr.html#cb48-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Pedigree-based ageprior (left) and default, flat ageprior (right).&quot;</span>,</span>
<span id="cb48-7"><a href="sec-smallCorr.html#cb48-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<table class="kable_wrapper">
<caption>
<span id="tab:PedComp-ex1">Table 6.1: </span>Pedigree-based ageprior (left) and default, flat ageprior (right).
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">M</th>
<th align="right">P</th>
<th align="right">FS</th>
<th align="right">MS</th>
<th align="right">PS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">5.043</td>
<td align="right">4.316</td>
<td align="right">3.862</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">3.476</td>
<td align="right">1.967</td>
<td align="right">2.798</td>
<td align="right">2.636</td>
<td align="right">2.971</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="right">2.011</td>
<td align="right">3.167</td>
<td align="right">0.077</td>
<td align="right">0.691</td>
<td align="right">0.583</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="right">0.340</td>
<td align="right">0.959</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">M</th>
<th align="right">P</th>
<th align="right">FS</th>
<th align="right">MS</th>
<th align="right">PS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p><span class="math display">\[\begin{equation}
    \alpha*_{A,R} = W_R \times \frac{P(A|R, \text{sampled})}{P(A, \text{sampled})} +
     (1-W_R) \times I_{A,R}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(W_R\)</span> is a weight based on <span class="math inline">\(N_{R}\)</span>, the number of pairs with relationship <span class="math inline">\(R\)</span> and known age difference. <span class="math inline">\(I_{A,R}\)</span> is an indicator whether the age-relationship combination is possible (1) or not (0) based on the maximum parental age (i.e., the flat default ageprior). <span class="math inline">\(\alpha_{A,R} = P(A|R, \text{sampled}) / P(A, \text{sampled})\)</span> is the raw pedigree-based ageprior.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="sec-smallCorr.html#cb49-1" aria-hidden="true" tabindex="-1"></a>AP.flattened <span class="ot">&lt;-</span> <span class="fu">MakeAgePrior</span>(Ped_griffin, <span class="at">Smooth=</span><span class="cn">FALSE</span>, <span class="at">Flatten=</span><span class="cn">TRUE</span>, <span class="at">quiet=</span><span class="cn">TRUE</span>, <span class="at">Plot=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table style="width:50%;">
<caption>
<span id="tab:PedComp-ex1c">Table 6.2: </span>Flattened ageprior
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
M
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
FS
</th>
<th style="text-align:right;">
MS
</th>
<th style="text-align:right;">
PS
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
2.761
</td>
<td style="text-align:right;">
3.574
</td>
<td style="text-align:right;">
2.918
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
2.698
</td>
<td style="text-align:right;">
1.655
</td>
<td style="text-align:right;">
1.783
</td>
<td style="text-align:right;">
2.270
</td>
<td style="text-align:right;">
2.321
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
1.693
</td>
<td style="text-align:right;">
2.467
</td>
<td style="text-align:right;">
0.598
</td>
<td style="text-align:right;">
0.760
</td>
<td style="text-align:right;">
0.721
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.548
</td>
<td style="text-align:right;">
0.972
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
</tbody>
</table>
<div id="weighing-factor-lambdanw" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Weighing factor &amp; <code>lambdaNW</code></h3>
<p>The weighing factor <span class="math inline">\(W_R\)</span> follows a asymptotic curve when plotted against sample size (Figure <a href="sec-smallCorr.html#fig:plotFlattenNW">6.2</a>), and is calculated as
<span class="math display">\[\begin{equation}
W_R = 1 - \exp(-\lambda_{N,W} * N_R)  \text{ .}
\end{equation}\]</span></p>
<p>By default <span class="math inline">\(\lambda_{N,W}=-\log(0.5)/100\)</span> (input parameter <code>lambdaNW</code>), which corresponds to <span class="math inline">\(W_R&lt; 0.5\)</span> if <span class="math inline">\(N_R &lt; 100\)</span>; i.e. if there are fewer than 100 pairs with known age difference, the flat ageprior weighs heavier than the pedigree-inferred ageprior, and the opposite if there are more than 100 pairs. When <span class="math inline">\(\lambda_{N,W}\)</span> is large (say <span class="math inline">\(&gt;0.2\)</span>), <code>Flatten</code> is effectively only applied for relationships with very small sample size (e.g. <span class="math inline">\(W=0.86\)</span> at <span class="math inline">\(N=10\)</span>), while when <span class="math inline">\(\lambda_{N,W}\)</span> is small (say <span class="math inline">\(&lt;0.0001\)</span>) there is effectively no contribution of the pedigree even with very large sample size (e.g. <span class="math inline">\(W=0.10\)</span> at <span class="math inline">\(N=1000\)</span>).</p>
<div class="figure"><span id="fig:plotFlattenNW"></span>
<img src="figs/plotFlattenNW-1.png" alt="Weights versus number of pairs with relationship R, for weighed average between pedigree-derived ageprior and flat 0/1 ageprior" width="60%" />
<p class="caption">
Figure 6.2: Weights versus number of pairs with relationship R, for weighed average between pedigree-derived ageprior and flat 0/1 ageprior
</p>
</div>
<p>Since the number of pairs with known age difference will differ between relationship types, so will the weights:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="sec-smallCorr.html#cb50-1" aria-hidden="true" tabindex="-1"></a>AP.griffin<span class="sc">$</span>Weights</span></code></pre></div>
<pre><code>##      M      P     FS     MS     PS 
## 0.6857 0.6769 0.0341 0.7762 0.6701</code></pre>
<p>By chance there are more maternal than paternal sibling pairs in this pedigree, due to one large maternal sibship (see <code>SummarySeq(Ped_griffin)</code>), and thus the weight for ‘MS’ is larger than for ‘PS.’ We can use the pair counts per relationship to double check the weights:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="sec-smallCorr.html#cb52-1" aria-hidden="true" tabindex="-1"></a>NAK.R   <span class="co"># counts per relationship (column sums of tblA.R)</span></span></code></pre></div>
<pre><code>##     M     P    FS    MS    PS     X 
##   167   163     5   216   160 19900</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="sec-smallCorr.html#cb54-1" aria-hidden="true" tabindex="-1"></a>lambdaNW <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="fl">0.5</span>)<span class="sc">/</span><span class="dv">100</span>     <span class="co"># default input value</span></span>
<span id="cb54-2"><a href="sec-smallCorr.html#cb54-2" aria-hidden="true" tabindex="-1"></a>W.R <span class="ot">&lt;-</span>  <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>lambdaNW <span class="sc">*</span> NAK.R[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb54-3"><a href="sec-smallCorr.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(W.R, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##      M      P     FS     MS     PS 
## 0.6857 0.6769 0.0341 0.7762 0.6701</code></pre>
</div>
<div id="sample-size-vs.-sampling-probability" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Sample size vs. sampling probability</h3>
<p>In theory, the sampling probability per relationship could be estimated, and used to calculate some correction factor for equation <a href="maths.html#eq:AP2">(2.2)</a>. In practice, this requires some strong assumptions about the number of assignable parents (i.e. distinction between pedigree founders and non-founders) and the number of sibling pairs (i.e. distribution of sibship sizes). Moreover, this correction factor would depend on the total number of sampled individuals in a non-nonsensical way: removing individuals without assigned parents from the pedigree would ‘magically’ increase our faith in the ageprior estimated from the remainder of the pedigree. Therefore, the degree of correction by <code>Flatten</code> depends only on the <em>number</em> of individual pairs per relationship with known age difference, not on a proportion.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pedigree-based-ageprior.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec-GP-AU.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
