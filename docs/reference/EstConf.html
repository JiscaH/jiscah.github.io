<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Estimate confidence probabilities ('backward') and assignment
  error rates ('forward') per category (genotyped/dummy) by repeatedly
  simulating genotype data from a reference pedigree using
  SimGeno, reconstruction a pedigree from this using
  sequoia, and counting the number of mismatches using
  PedCompare."><title>Confidence Probabilities — EstConf • sequoia</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Confidence Probabilities — EstConf"><meta property="og:description" content="Estimate confidence probabilities ('backward') and assignment
  error rates ('forward') per category (genotyped/dummy) by repeatedly
  simulating genotype data from a reference pedigree using
  SimGeno, reconstruction a pedigree from this using
  sequoia, and counting the number of mismatches using
  PedCompare."><meta property="og:image" content="https://jiscah.github.io/reference/figures/sequoia_hexlogo.png"><meta property="og:image:alt" content="sequoia hexlogo"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@HuismanJisca"><meta name="twitter:site" content="@HuismanJisca"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sequoia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href=".././index.html">
    <span class="fas fa fas fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/sequoia.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette_main/book/background.html">Main vignette: User guide</a>
    <a class="dropdown-item" href="../articles/vignette_age/book/index.html">Age prior vignette</a>
    <a class="dropdown-item" href="../articles/sequoia_report.html">Mock report</a>
    <a class="dropdown-item" href="../articles/index.html">Examples &amp; More info on ...</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/performance_stats.html">Performance Stats</a>
    <a class="dropdown-item" href="../reference/figures/Poster_sequoia_ESEB2017.pdf">poster</a>
    <a class="dropdown-item" href="../reference/figures/Slideshow_sequoia_background.pdf">slideshow with background info</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Change log</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-help">Help</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-help">
    <a class="dropdown-item" href="../articles/help.html">Need help?</a>
    <a class="dropdown-item" href="../articles/want_to_help.html">Want to help?</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/pedigree_consultancy.html">Consultancy</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="nav-link" href="../mailto:jisca.huisman@gmail.com">
    <span class="fas fa fas fa-envelope"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JiscaH/sequoia">
    <span class="fab fa fab fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://ecoevo.social/@HuismanJisca">
    <span class="fab fa fab fa-mastodon"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.linkedin.com/in/jisca-huisman-a4751153/">
    <span class="fab fa fab fa-linkedin-in"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Confidence Probabilities</h1>
      
      <div class="d-none name"><code>EstConf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimate confidence probabilities ('backward') and assignment
  error rates ('forward') per category (genotyped/dummy) by repeatedly
  simulating genotype data from a reference pedigree using
  <code><a href="SimGeno.html">SimGeno</a></code>, reconstruction a pedigree from this using
  <code><a href="sequoia.html">sequoia</a></code>, and counting the number of mismatches using
  <code><a href="PedCompare.html">PedCompare</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">EstConf</span><span class="op">(</span></span>
<span>  Pedigree <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  LifeHistData <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  args.sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nSnp <span class="op">=</span> <span class="fl">400</span>, SnpError <span class="op">=</span> <span class="fl">0.001</span>, ParMis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  args.seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Module <span class="op">=</span> <span class="st">"ped"</span>, Err <span class="op">=</span> <span class="fl">0.001</span>, Tassign <span class="op">=</span> <span class="fl">0.5</span>, CalcLLR <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  nSim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  nCores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>Pedigree</dt>
<dd><p>reference pedigree from which to simulate, dataframe with
columns id-dam-sire. Additional columns are ignored.</p></dd>


<dt>LifeHistData</dt>
<dd><p>dataframe with id, sex (1=female, 2=male, 3=unknown),
birth year, and optionally BY.min - BY.max - YearLast.</p></dd>


<dt>args.sim</dt>
<dd><p>list of arguments to pass to <code><a href="SimGeno.html">SimGeno</a></code>, such as
<code>nSnp</code> (number of SNPs), <code>SnpError</code> (genotyping error rate) and
<code>ParMis</code> (proportion of non-genotyped parents). Set to <code>NULL</code> to
use all default values.</p></dd>


<dt>args.seq</dt>
<dd><p>list of arguments to pass to <code><a href="sequoia.html">sequoia</a></code>, such as
<code>Module</code> ('par' or 'ped'), <code>Err</code> (assumed genotyping error rate),
and <code>Complex</code>. May include (part of) <code>SeqList</code>, a list of sequoia
output (i.e. as a list-within-a-list). Set to <code>NULL</code> to use all
default values.</p></dd>


<dt>nSim</dt>
<dd><p>number of iterations of simulate - reconstruct - compare to
perform, i.e. number of simulated datasets.</p></dd>


<dt>nCores</dt>
<dd><p>number of computer cores to use. If <code>&gt;1</code>, package
<span class="pkg">parallel</span> is used. Set to NULL to use all but one of the available
cores, as detected by <code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">parallel::detectCores()</a></code> (using all cores tends
to freeze up your computer).</p></dd>


<dt>quiet</dt>
<dd><p>suppress messages. <code>TRUE</code> runs <code>SimGeno</code> and
<code>sequoia</code> quietly, <code>'very'</code> also suppresses other messages and
the iteration counter when <code>nCores=1</code> (there is no iteration counter
when <code>nCores&gt;1</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list, with elements:</p>
<dl><dt>ConfProb</dt>
<dd><p>See below</p></dd>

  <dt>PedErrors</dt>
<dd><p>See below</p></dd>

  <dt>Pedigree.reference</dt>
<dd><p>the pedigree from which data was simulated</p></dd>

  <dt>LifeHistData</dt>
<dd></dd>

  <dt>Pedigree.inferred</dt>
<dd><p>a list with for each iteration the inferred
    pedigree based on the simulated data</p></dd>

  <dt>SimSNPd</dt>
<dd><p>a list with for each iteration the IDs of the individuals
    simulated to have been genotyped</p></dd>

  <dt>PedComp.fwd</dt>
<dd><p>array with <code>Counts</code> from the 'forward'
    <code>PedCompare</code>, from which <code>PedErrors</code> is calculated</p></dd>

  <dt>RunParams</dt>
<dd><p>a list with the call to <code>EstConf</code> as a semi-nested
  list (args.sim, args.seq, nSim, nCores), as well as the default parameter
  values for <code>SimGeno</code> and <code>sequoia</code>.</p></dd>

  <dt>RunTime</dt>
<dd><p><code>sequoia</code> runtime per simulation in seconds, as
    measured by <code><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a>()['elapsed']</code>.</p></dd>


</dl><p>Dataframe <code>ConfProb</code> has 7 columns:</p>
<dl><dt>id.cat, dam.cat, sire.cat</dt>
<dd><p>Category of the focal individual, dam, and
  sire, in the pedigree inferred based on the simulated data. Coded as
  G=genotyped, D=dummy, X=none</p></dd>

<dt>dam.conf</dt>
<dd><p>Probability that the dam is correct, given the categories of
  the assigned dam and sire (ignoring whether or not the sire is correct)</p></dd>

<dt>sire.conf</dt>
<dd><p>as <code>dam.conf</code>, for the sire</p></dd>

<dt>pair.conf</dt>
<dd><p>Probability that both dam and sire are correct, given their
  categories</p></dd>

<dt>N</dt>
<dd><p>Number of individuals per category-combination, across all
  <code>nSim</code> iterations</p></dd>


</dl><p>Array <code>PedErrors</code> has three dimensions:</p>
<dl><dt>class</dt>
<dd><ul><li><p><code>FalseNeg</code>(atives): could have been assigned but was not
(individual + parent both genotyped or dummyfiable; P1only in
<code>PedCompare</code>).</p></li>
<li><p><code>FalsePos</code>(itives): no parent in reference pedigree, but
one was assigned based on the simulated data (P2only)</p></li>
<li><p><code>Mismatch</code>: different parents between the pedigrees</p></li>
</ul></dd>

<dt>cat</dt>
<dd><p>Category of individual + parent, as a two-letter code where the
  first letter indicates the focal individual and the second the parent;
  G=Genotyped, D=Dummy, T=Total</p></dd>

<dt>parent</dt>
<dd><p>dam or sire</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The confidence probability is taken as the number of correct
  (matching) assignments, divided by all assignments made in the
  <em>observed</em> (inferred-from-simulated) pedigree. In contrast, the false
  negative &amp; false positive assignment rates are proportions of the number of
  parents in the <em>true</em> (reference) pedigree. Each rate is calculated
  separatedly for dams &amp; sires, and separately for each category
  (<strong>G</strong>enotyped/<strong>D</strong>ummy(fiable)/<strong>X</strong> (none)) of
  individual, parent and co-parent.</p>
<p>This function does not know which individuals in the actual <code>Pedigree</code>
 are genotyped, so the confidence probabilities need to be added to the
 <code>Pedigree</code> as shown in the example at the bottom.</p>
<p>A confidence of \(1\) means all assignments on simulated data were correct for
 that category-combination. It should be interpreted as (and perhaps modified
 to) \(&gt; 1 - 1/N\), where sample size <code>N</code> is given in the last column
 of the <code>ConfProb</code> and <code>PedErrors</code> dataframes in the output. The
 same applies for a false negative/positive rate of \(0\) (i.e. to be
 interpreted as \(&lt; 1/N\)).</p>
    </div>
    <div class="section level2">
    <h2 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a></h2>
    

<p>Because the actual true pedigree is (typically) unknown, the provided
  reference pedigree is used as a stand-in and assumed to be the true
  pedigree, with unrelated founders. It is also assumed that the probability
  to be genotyped is equal for all parents; in each iteration, a new random
  set of parents (proportion set by <code>ParMis</code>) is mimicked to be
  non-genotyped. In addition, SNPs are assumed to segregate independently.</p>
<p>An experimental version offering more fine-grained control is available at
  https://github.com/JiscaH/sequoiaExtra .</p>
    </div>
    <div class="section level2">
    <h2 id="object-size">Object size<a class="anchor" aria-label="anchor" href="#object-size"></a></h2>
    

<p>The size in Kb of the returned list can become pretty big, as each of the
  inferred pedigrees is included. When running <code>EstConf</code> many times for
  a range of parameter values, it may be prudent to save the required summary
  statistics for each run rather than the full output.</p>
    </div>
    <div class="section level2">
    <h2 id="errors">Errors<a class="anchor" aria-label="anchor" href="#errors"></a></h2>
    

<p>If you have a large pedigree and try to run this function on multiple
  cores, you may run into "Cannot allocate vector of size ..." errors or even
  unexpected crashes: there is not enough computer memory for each separate
  run. Try reducing `nCores`.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="SimGeno.html">SimGeno</a>, <a href="sequoia.html">sequoia</a>, <a href="PedCompare.html">PedCompare</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># estimate proportion of parents that are genotyped (= 1 - ParMis)</span></span></span>
<span class="r-in"><span><span class="va">sumry_grif</span> <span class="op">&lt;-</span> <span class="fu"><a href="SummarySeq.html">SummarySeq</a></span><span class="op">(</span><span class="va">SeqOUT_griffin</span>, Plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">sumry_grif</span><span class="op">$</span><span class="va">ParentCount</span><span class="op">[</span><span class="st">'Genotyped'</span>,,,<span class="op">]</span>,</span></span>
<span class="r-in"><span>             MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'parentSex'</span>, <span class="st">'parentCat'</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">props</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">tmp</span>, MARGIN<span class="op">=</span><span class="st">'parentCat'</span>, STATS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="st">'/'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fl">1</span> <span class="op">-</span> <span class="va">props</span><span class="op">[</span>,<span class="st">'Genotyped'</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="va">props</span><span class="op">[</span>,<span class="st">'Genotyped'</span><span class="op">]</span> <span class="op">+</span> <span class="va">props</span><span class="op">[</span>,<span class="st">'Dummy'</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Dam      Sire </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3867925 0.2178218 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example for parentage assignment only</span></span></span>
<span class="r-in"><span><span class="va">conf_grif</span> <span class="op">&lt;-</span> <span class="fu">EstConf</span><span class="op">(</span>Pedigree <span class="op">=</span> <span class="va">SeqOUT_griffin</span><span class="op">$</span><span class="va">Pedigree</span>,</span></span>
<span class="r-in"><span>               LifeHistData <span class="op">=</span> <span class="va">SeqOUT_griffin</span><span class="op">$</span><span class="va">LifeHist</span>,</span></span>
<span class="r-in"><span>               args.sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nSnp <span class="op">=</span> <span class="fl">150</span>,   <span class="co"># no. in actual data, or what-if</span></span></span>
<span class="r-in"><span>                               SnpError <span class="op">=</span> <span class="fl">5e-3</span>,  <span class="co"># best estimate, or what-if</span></span></span>
<span class="r-in"><span>                               CallRate<span class="op">=</span><span class="fl">0.9</span>,     <span class="co"># from SnpStats()</span></span></span>
<span class="r-in"><span>                               ParMis<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.39</span>, <span class="fl">0.20</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># calc'd above</span></span></span>
<span class="r-in"><span>               args.seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Err<span class="op">=</span><span class="fl">5e-3</span>, Module<span class="op">=</span><span class="st">"par"</span><span class="op">)</span>,  <span class="co"># as in real run</span></span></span>
<span class="r-in"><span>               nSim <span class="op">=</span> <span class="fl">1</span>,   <span class="co"># try-out, proper run &gt;=20 (10 if huge pedigree)</span></span></span>
<span class="r-in"><span>               nCores<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Simulating parentage assignment only ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> i= 1 	 14:08:44 </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span> There are 1 SNPs scored for &lt;50% of individuals </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># parent-pair confidence, per category (Genotyped/Dummy/None)</span></span></span>
<span class="r-in"><span><span class="va">conf_grif</span><span class="op">$</span><span class="va">ConfProb</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    id.cat dam.cat sire.cat dam.conf sire.conf pair.conf  N</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14      G       G        G        1         1         1 90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15      G       G        X        1        NA        NA 24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17      G       X        G       NA         1        NA  6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18      G       X        X       NA        NA        NA 40</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Proportion of true parents that was correctly assigned</span></span></span>
<span class="r-in"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">conf_grif</span><span class="op">$</span><span class="va">PedErrors</span>, MARGIN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'cat'</span>,<span class="st">'parent'</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">sum</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     parent</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cat    dam      sire</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   GG 0.950 0.9795918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   GD 1.000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   GT 0.950 0.8275862</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   DG 0.000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   DD 1.000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   DT 0.000 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   TT 0.912 0.7868852</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add columns with confidence probabilities to pedigree</span></span></span>
<span class="r-in"><span><span class="co"># first add columns with category (G/D/X)</span></span></span>
<span class="r-in"><span><span class="va">Ped.withConf</span> <span class="op">&lt;-</span> <span class="fu"><a href="getAssignCat.html">getAssignCat</a></span><span class="op">(</span>Pedigree <span class="op">=</span> <span class="va">SeqOUT_griffin</span><span class="op">$</span><span class="va">Pedigree</span>,</span></span>
<span class="r-in"><span>                             SNPd <span class="op">=</span> <span class="va">SeqOUT_griffin</span><span class="op">$</span><span class="va">PedigreePar</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Ped.withConf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">Ped.withConf</span>, <span class="va">conf_grif</span><span class="op">$</span><span class="va">ConfProb</span>, all.x<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                      sort<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># (note: merge() messes up column order)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Ped.withConf</span><span class="op">[</span><span class="va">Ped.withConf</span><span class="op">$</span><span class="va">dam.cat</span><span class="op">==</span><span class="st">"G"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    id.cat dam.cat sire.cat          id         dam        sire LLRdam LLRsire</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31      G       G        G i025_2002_M i014_2001_F i018_2001_M   8.34    7.65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32      G       G        G i110_2006_M i061_2004_F i073_2004_M  10.46    6.15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33      G       G        G i145_2008_F i132_2007_F i127_2007_M   6.69    7.83</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34      G       G        G i050_2003_M i033_2002_F i028_2002_M   7.15    5.91</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35      G       G        G i080_2004_M i041_2003_F i039_2002_M   8.61    3.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36      G       G        G i136_2007_M i095_2005_F i089_2005_M   8.97   11.15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    LLRpair OHdam OHsire MEpair dam.conf sire.conf pair.conf  N</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31   17.42     0      0      0        1         1         1 90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32   18.34     0      0      0        1         1         1 90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33   15.94     0      0      0        1         1         1 90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34   16.04     0      0      0        1         1         1 90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35   17.62     1      0      1        1         1         1 90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36   15.77     0      0      0        1         1         1 90</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># save output summary</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">conf_griff</span><span class="op">[[</span><span class="st">'Note'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'You could add a note'</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">conf_grif</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ConfProb'</span>,<span class="st">'PedComp.fwd'</span>,<span class="st">'RunParams'</span>,<span class="st">'RunTime'</span>,<span class="st">'Note'</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>   file <span class="op">=</span> <span class="st">'conf_200SNPs_Err005_Callrate80.RDS'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## P(actual FS | inferred as FS) etc.</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">PairL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">conf_grif</span><span class="op">$</span><span class="va">Pedigree.inferred</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># nSim</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"\t"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">PairL</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="ComparePairs.html">ComparePairs</a></span><span class="op">(</span><span class="va">conf_grif</span><span class="op">$</span><span class="va">Pedigree.reference</span>,</span></span>
<span class="r-in"><span>                             <span class="va">conf_grif</span><span class="op">$</span><span class="va">Pedigree.inferred</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                             GenBack<span class="op">=</span><span class="fl">1</span>, patmat<span class="op">=</span><span class="cn">TRUE</span>, ExcludeDummies <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                             Return<span class="op">=</span><span class="st">"Counts"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="co"># P(actual relationship (Ped1) | inferred relationship (Ped2))</span></span></span>
<span class="r-in"><span><span class="va">PairRel.prop.A</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/laply.html" class="external-link">laply</a></span><span class="op">(</span><span class="va">PairL</span>, <span class="kw">function</span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></span>
<span class="r-in"><span>                     <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">M</span>, MARGIN<span class="op">=</span><span class="st">'Ped2'</span>, STATS<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span>, FUN<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">PairRel.prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">PairRel.prop.A</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co">#avg across sims</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">PairRel.prop</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># or: P(inferred relationship | actual relationship)</span></span></span>
<span class="r-in"><span><span class="va">PairRel.prop2</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/laply.html" class="external-link">laply</a></span><span class="op">(</span><span class="va">PairL</span>, <span class="kw">function</span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">M</span>, MARGIN<span class="op">=</span><span class="st">'Ped1'</span>, STATS<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span>, FUN<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># confidence probability vs. sibship size</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/JiscaH/sequoiaExtra/main/conf_vs_sibsize.R'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">conf_grif_nOff</span> <span class="op">&lt;-</span> <span class="fu">Conf_by_nOff</span><span class="op">(</span><span class="va">conf_grif</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">conf_grif_nOff</span><span class="op">[</span><span class="st">'conf'</span>,,<span class="st">'GD'</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">conf_grif_nOff</span><span class="op">[</span><span class="st">'N'</span>,,<span class="st">'GD'</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Jisca Huisman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

    </footer></div>

  

  

  </body></html>

