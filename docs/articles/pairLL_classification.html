<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classification of pairs using likelihoods • sequoia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Classification of pairs using likelihoods">
<meta property="og:description" content="Use of function `CalcPairLL()`, e.g. when assignment rate with `sequoia()` is low
">
<meta property="og:image" content="/reference/figures/sequoia_hexlogo_s.png">
<meta property="og:image:alt" content="sequoia hexlogo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sequoia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href=".././index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Get_started.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Manuals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_main/book/sec-Background.html">Main vignette: User guide</a>
    </li>
    <li>
      <a href="../articles/vignette_age/book/index.html">Age prior vignette</a>
    </li>
    <li>
      <a href="../articles/index.html">Examples</a>
    </li>
    <li>
      <a href="../articles/index.html">More info on ...</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
<li>
  <a href="../articles/help.html">Help</a>
</li>
<li>
  <a href="../articles/performance_stats.html">Stats</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/HuismanJisca">
    <span class="fab fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="../mailto:jisca.huisman@gmail.com">
    <span class="fas fa-envelope"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/JiscaH/sequoia">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/jisca-huisman-a4751153/">
    <span class="fab fa-linkedin-in"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="pairLL_classification_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Classification of pairs using likelihoods</h1>
            
      
      
      <div class="hidden name"><code>pairLL_classification.Rmd</code></div>

    </div>

    
    
<hr>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Pedigree reconstruction with <code><a href="../reference/sequoia.html">sequoia()</a></code> sometimes suffers from high rates of non-assignment of true relatives (false negatives). This is often because it cannot tell whether a pair are maternal or paternal relatives, or it cannot tell what type of second degree relatives they are. More information on this can be found <a href="vignette_main/book/key-points.html#sec:lowAR">here in the user guide</a>).</p>
<p>A fairly common situation is to have full sibling (FS), half sibling (HS), or unrelated (U) as the only three plausible relationships among the genotyped individuals, e.g. when nestlings are sampled but their parents are not. Typically none of the half sibling pairs will be assigned by <code><a href="../reference/sequoia.html">sequoia()</a></code>, as it cannot tell whether they are maternal or paternal half-siblings. When generations overlap, the possibility that they are full avuncular or grandparental also remains open genetically, even if this is biologically highly unlikely for clutch mates (for most species).</p>
<p>In such a situation, the likelihoods to be FS, HS, and U are the only three that are relevant, but there is no good way during pedigree reconstruction to set the prior for all other relationships to zero (including e.g. full cousins) and to abandon the distinction between maternal and paternal relatives (only implemented for hermaphrodites).</p>
<div id="likelihood-ratios" class="section level3">
<h3 class="hasAnchor">
<a href="#likelihood-ratios" class="anchor"></a>Likelihood ratios</h3>
<p>The function <code><a href="../reference/CalcPairLL.html">CalcPairLL()</a></code> lets you get ‘back to basics’ and returns the log10-likelihoods for various different relationships for each of the specified pairs of individuals. The log10-likelihood values in its output cannot be directly compared between pair: they differ because their genotypes differ. The likelihood <em>ratios</em> however are on a comparable scale between individuals, e.g. the ratio between how likely it is to be full siblings versus half sibling, or half sibling versus unrelated.</p>
</div>
<div id="caution" class="section level3">
<h3 class="hasAnchor">
<a href="#caution" class="anchor"></a>CAUTION</h3>
<p>Comparisons between pairs should be done with caution: If pair A + B has a higher LLR(PO/U) than pair A + C, this does not necessarily make B a more likely parent of A than C. Both pairs may be parent-offspring (e.g. C parent of A, A parent of B), or B may actually be a full sibling (LLR(PO/U) &gt; 0, but LLR(PO/FS) &lt; 0).</p>
</div>
<div id="applicable-to-other-relationships" class="section level3">
<h3 class="hasAnchor">
<a href="#applicable-to-other-relationships" class="anchor"></a>Applicable to other relationships</h3>
<p>Here the example of full siblings, half siblings and unrelated is used, but one could also have a situation where parent and full avuncular are the alternatives, or any other combination. Just keep in mind that all 3rd degree relationships are piled together under the ‘HA’ category, and that when <code>Complx='full'</code> all kinds of <a href="vignette_main/book/key-points.html#sec:WeirdRels">double relationships</a> are considered too.</p>
</div>
</div>
<div id="with-or-without-pedigree" class="section level2">
<h2 class="hasAnchor">
<a href="#with-or-without-pedigree" class="anchor"></a>With or without pedigree</h2>
<p>The likelihood ratio full sibling vs unrelated (LR(FS/U)) between two individuals can be calculated ignorant of the pedigree, or conditional on it. The latter increases power if individual A already has siblings, as the calculated LR is between B being a full (or half) sibling of A <em>and all A’s siblings</em>, versus being unrelated to A’s sibling cluster. This is similar as to what happens during sibship clustering, except that instead of gradually building up sibship clusters, the sibling clusters are provided at initiation.</p>
<p>The caveat is that <code><a href="../reference/CalcPairLL.html">CalcPairLL()</a></code> does not check whether the provided pedigree is a correct or even plausible pedigree. If some of the supposed siblings of A are in fact unrelated, the LR between B and A conditional on the incorrect pedigree becomes ambiguous and virtually useless. It is therefore prudent to check and if necessary trim a pedigree before conditioning on it (e.g. using <code><a href="../reference/CalcOHLLR.html">CalcOHLLR()</a></code>, or removing any inconsistencies between genetic and field pedigree).</p>
<p>Here the approach will first be illustrated without conditioning on a pedigree, and then conditional on a pedigree.</p>
</div>
<div id="example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example data</h2>
<p>To illustrate we use a single birth year cohort from the <code>Ped_HSg5</code> example pedigree in the package. This pedigree has discrete generations, and each generation 24 females mates with 2 males each, and 16 males with 3 females each; each mating produces exactly 4 offspring. All founders are born in 2000, the parents for the 2001 cohort considered here are thus all simulated as unrelated.</p>
<p>This could for example be an egg-laying species were females have two broods per year, and 4 eggs/hatchlings per brood are sampled for genotyping. If egg dumping does not occur [^a], half-siblings within the same brood will always be maternal half-siblings, and half-siblings across different broods laid at the same time will be paternal half-siblings. With egg dumping, the puzzle becomes a bit more complicated but not necessarily impossible to solve</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Ped_HSg5</span>, <span class="va">LH_HSg5</span>, package <span class="op">=</span> <span class="st">"sequoia"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>,<span class="st">"dam"</span>,<span class="st">"sire"</span><span class="op">)</span><span class="op">)</span>  <span class="va">Ped_HSg5</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">Ped_HSg5</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>

<span class="co"># looking at 2001 'hatchlings' only. </span>
<span class="va">Ped.2001</span> <span class="op">&lt;-</span> <span class="va">Ped_HSg5</span><span class="op">[</span><span class="va">Ped_HSg5</span><span class="op">$</span><span class="va">id</span> <span class="op">%in%</span> <span class="va">LH_HSg5</span><span class="op">$</span><span class="va">ID</span><span class="op">[</span><span class="va">LH_HSg5</span><span class="op">$</span><span class="va">BirthYear</span> <span class="op">&lt;=</span> <span class="fl">2001</span><span class="op">]</span>, <span class="op">]</span>
<span class="co"># total 192 individuals, across 24 dams x 16 sires</span>

<span class="co"># simulate genetic data:</span>
<span class="va">Geno.2001</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SimGeno.html">SimGeno</a></span><span class="op">(</span>Pedigree <span class="op">=</span> <span class="va">Ped.2001</span>, 
                     ParMis <span class="op">=</span> <span class="fl">1.0</span>,     <span class="co"># all parents non-genotyped</span>
                     nSnp <span class="op">=</span> <span class="fl">400</span>, SnpError <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span></code></pre></div>
<div id="find-pairs-of-likely-relatives" class="section level3">
<h3 class="hasAnchor">
<a href="#find-pairs-of-likely-relatives" class="anchor"></a>Find pairs of likely relatives</h3>
<p>To reduce computational time (and memory size of the output object), it is often a good idea to only calculate likelihoods for pairs that are somewhat likely to be related. In this moderately sized example with 192 genotyped individuals, there are <span class="math inline">\((192 \times 191)/2= 18336\)</span> unique pairs. Even when every individual belongs to a sibship, most pairs of individuals are unrelated:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># matrix with type of relationship between each pair of individuals in a pedigree:</span>
<span class="va">RelM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetRelM.html">GetRelM</a></span><span class="op">(</span><span class="va">Ped.2001</span><span class="op">)</span>

<span class="co"># Note: GetRelM() adds entries for all parents, using PedPolish()</span>
<span class="co"># removing those again...:</span>
<span class="va">SampleIDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">Geno.2001</span><span class="op">)</span>
<span class="va">RelM</span> <span class="op">&lt;-</span> <span class="va">RelM</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">SampleIDs</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">RelM</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">SampleIDs</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">RelM</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> 

<span class="co"># each pair is included twice in the matrix: above &amp; below the diagonal</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">RelM</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></code></pre></div>
<pre><code>## RelM
##    FS    HS     S     U 
##   320  1088    96 16928</code></pre>
<p>thus, 33856 of these pairs are unrelated (U), or 92%.</p>
<p>Subsetting pairs can be done based on field data (e.g. only check within-nest, or among neighbouring nests), or based on the genetic data. For the latter, use <code><a href="../reference/GetMaybeRel.html">GetMaybeRel()</a></code>, optionally with a much more liberal threshold than you would normally use.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make mock lifehistory data for this example:</span>
<span class="co"># all individuals same birth year + specifying non-overlapping generations</span>
<span class="co"># ensures that parent-offspring, aunt/uncle, etc. are not considered as </span>
<span class="co"># relationship alternatives. </span>
<span class="va">LHX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">Geno.2001</span><span class="op">)</span>,
                  Sex <span class="op">=</span> <span class="fl">3</span>,
                  BirthYear <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">AP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MakeAgePrior.html">MakeAgePrior</a></span><span class="op">(</span>Discrete<span class="op">=</span><span class="cn">TRUE</span>, Plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## Ageprior: Flat 0/1, discrete generations, MaxAgeParent = 1,1</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetMaybeRel.html">GetMaybeRel</a></span><span class="op">(</span><span class="va">Geno.2001</span>,
                  LifeHistData <span class="op">=</span> <span class="va">LHX</span>,
                  AgePrior <span class="op">=</span> <span class="va">AP</span>,
                  Module <span class="op">=</span> <span class="st">"ped"</span>,   <span class="co"># search for all kinds of relatives, not just parent-offspring</span>
                  Complex <span class="op">=</span> <span class="st">"simp"</span>,  <span class="co"># don't consider double relationships etc</span>
                  Err <span class="op">=</span> <span class="fl">0.005</span>,
                  Tassign <span class="op">=</span> <span class="fl">0.1</span>,
                  Tfilter <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>,
                  MaxPairs <span class="op">=</span> <span class="fl">20</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Geno.2001</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Searching for non-assigned relative pairs ... (Module = ped)</code></pre>
<pre><code>## Genotype matrix looks OK! There are  192  individuals and  400  SNPs.</code></pre>
<pre><code>## Counting opposing homozygous loci between all individuals ...
## Checking for non-assigned relatives ...</code></pre>
<pre><code>## Found 0 likely parent-offspring pairs, and 848 other non-assigned pairs of possible relatives</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">MR</span><span class="op">$</span><span class="va">MaybeRel</span><span class="op">)</span></code></pre></div>
<pre><code>##      ID1    ID2 TopRel   LLR OH BirthYear1 BirthYear2 AgeDif Sex1 Sex2 SNPdBoth
## 1 b01149 a01150     FS 14.05  0          1          1      0    3    3      396
## 2 a01150 a01152     FS 13.53  0          1          1      0    3    3      397
## 3 a01071 b01072     FS 12.81  0          1          1      0    3    3      396
## 4 b01134 a01135     FS 12.70  0          1          1      0    3    3      392
## 5 b01037 b01040     FS 12.68  0          1          1      0    3    3      392
## 6 b01121 a01123     FS 12.59  0          1          1      0    3    3      390</code></pre>
<p>The output from GetMaybeRel only shows the most likely relationship (for these 6 it is full sibling (<code>TopRel = FS</code>), and how much more likely this is than the next-most-likely relationship (column <code>LLR</code>). It does not show what the next-most-likely relationship is, or how much more likely these pairs are to be full siblings versus unrelated. Some pairs may be about equally likely to be full siblings as half-siblings, resulting in a low LLR, but it does not show how much more likely both sibling categories are versus unrelated.</p>
</div>
<div id="calculate-likelihoods" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-likelihoods" class="anchor"></a>Calculate likelihoods</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PairLL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalcPairLL.html">CalcPairLL</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">MR</span><span class="op">$</span><span class="va">MaybeRel</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID1"</span>, <span class="st">"ID2"</span><span class="op">)</span><span class="op">]</span>,
                                focal <span class="op">=</span> <span class="st">"U"</span><span class="op">)</span>,  <span class="co"># see help file for details</span>
                     <span class="va">Geno.2001</span>,
                     LifeHistData <span class="op">=</span> <span class="va">LHX</span>,
                     AgePrior <span class="op">=</span> <span class="va">AP</span>,
                     Complex <span class="op">=</span> <span class="st">"simp"</span>,
                     Err <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span></code></pre></div>
<p><img src="pairLL_classification_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<p>The upper-right panel (LLR(FS/U) vs LLR(HS/U)) shows that there are a large number of pairs in this dataset that are clearly full siblings (above diagonal), and a number that are likely half-siblings (blue dots), but also a substantial number that seem to be some kind of second or third degree relative but it is unclear how they are exactly related (yellow dots).</p>
<p>The difference between the likely half-siblings and ‘unclear’ is not obvious in the above plot, but comes about via the likelihood ratio between half-siblings versus third degree relative (see further).</p>
<p>For contrast, let’s also calculate likelihoods for a random set of pairs:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pairs.random</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">SampleIDs</span>, size<span class="op">=</span><span class="fl">500</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,
                           ID2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">SampleIDs</span>, size<span class="op">=</span><span class="fl">500</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,
                           focal <span class="op">=</span> <span class="st">"U"</span><span class="op">)</span>
<span class="co"># exclude if by chance ID1 == ID2</span>
<span class="va">Pairs.random</span> <span class="op">&lt;-</span> <span class="va">Pairs.random</span><span class="op">[</span><span class="va">Pairs.random</span><span class="op">$</span><span class="va">ID1</span> <span class="op">!=</span> <span class="va">Pairs.random</span><span class="op">$</span><span class="va">ID2</span>, <span class="op">]</span>
  
<span class="va">Pairs.random.LL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalcPairLL.html">CalcPairLL</a></span><span class="op">(</span><span class="va">Pairs.random</span>, 
                     <span class="va">Geno.2001</span>,
                     LifeHistData <span class="op">=</span> <span class="va">LHX</span>,
                     AgePrior <span class="op">=</span> <span class="va">AP</span>,
                     Complex <span class="op">=</span> <span class="st">"simp"</span>,
                     Err <span class="op">=</span> <span class="fl">0.005</span>, Plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># plot only one panel, change assignment threshold </span>
<span class="fu"><a href="../reference/PlotPairLL.html">PlotPairLL</a></span><span class="op">(</span><span class="va">Pairs.random.LL</span>, combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HS"</span>, <span class="st">"FS"</span><span class="op">)</span><span class="op">)</span>, Tassign<span class="op">=</span><span class="fl">1.0</span><span class="op">)</span></code></pre></div>
<p><img src="pairLL_classification_files/figure-html/unnamed-chunk-6-1.png" width="60%"></p>
<p>For these random pairs, there is (usually) a clear divide between full siblings (above diagonal), half-siblings (below diagonal &amp; LLR(HS/U)<span class="math inline">\(&gt;0\)</span>), and unrelated (LLR(HS/U)<span class="math inline">\(&lt;0\)</span>).</p>
</div>
<div id="likelihood-ratios-1" class="section level3">
<h3 class="hasAnchor">
<a href="#likelihood-ratios-1" class="anchor"></a>Likelihood ratios</h3>
<p>Remember that</p>
<p><span class="math display">\[
\log(A / B) = \log(A) - \log(B)
\]</span> and that <code><a href="../reference/CalcPairLL.html">CalcPairLL()</a></code> returns log10-likelihood values. Log-likelihood values are always negative, as likelihoods are always between 0 and 1; positive values in the output are various types of <code>NA</code> (see help file).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maybesibs <span class="op">=</span> <span class="va">PairLL</span>,
              random <span class="op">=</span> <span class="va">Pairs.random.LL</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"maybesibs"</span>, <span class="st">"random"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LLR.FS.U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">FS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">FS</span> <span class="op">-</span> <span class="va">U</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
  <span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LLR.HS.U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">HS</span> <span class="op">-</span> <span class="va">U</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
  <span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LLR.FS.HS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">FS</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">FS</span> <span class="op">-</span> <span class="va">HS</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> 
  <span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LLR.HS.HA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">HA</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">HS</span> <span class="op">-</span> <span class="va">HA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> 
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfcol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.8</span>,<span class="fl">.8</span>,<span class="fl">.2</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="st">"random"</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">LLR.FS.U</span>, <span class="va">LLR.FS.HS</span>, pch<span class="op">=</span><span class="fl">16</span>,
                             xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">45</span>, <span class="fl">40</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">35</span>, <span class="fl">20</span><span class="op">)</span>,
                             col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"black"</span>, alpha.f<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># semi-transparant</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="st">"maybesibs"</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">LLR.FS.U</span>, <span class="va">LLR.FS.HS</span>, pch<span class="op">=</span><span class="fl">16</span>, 
                                  col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"blue"</span>, alpha.f<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, v<span class="op">=</span><span class="fl">0</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># horizontal &amp; vertical axis</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="st">"random"</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">LLR.FS.U</span>, <span class="va">LLR.HS.HA</span>, pch<span class="op">=</span><span class="fl">16</span>, 
                             xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">45</span>,<span class="fl">40</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="fl">5</span><span class="op">)</span>, 
                             col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"black"</span>, alpha.f<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="st">"maybesibs"</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">LLR.FS.U</span>, <span class="va">LLR.HS.HA</span>, pch<span class="op">=</span><span class="fl">16</span>, 
                                  col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"blue"</span>, alpha.f<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, v<span class="op">=</span><span class="fl">0</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># horizontal &amp; vertical axis</span></code></pre></div>
<p><img src="pairLL_classification_files/figure-html/unnamed-chunk-8-1.png" width="80%"></p>
<p>These scatterplots are the similar to the ones before, but in the left panel LLR(FS/HS) is on the y-axis: those pairs more likely to be full sibling than half sibling have positive values, and the remaining pairs negative values; and analogous for LLR(HS/HA) in the right panel.</p>
<p>The panels show three distinct blobs: full sibling, half sibling, and unrelated pairs. There are (usually) however also a number of points in-between the blobs: pairs for which it is unclear how they are related. For the pairs in-between the full- and half-sib blob, it is clear that they are some kind of sibling, and definitely not unrelated; but the pedigree reconstruction with <code><a href="../reference/sequoia.html">sequoia()</a></code> has no way to convert this information and leaves such a pair unassigned.</p>
<p>Comparing the two panels also shows that while the different likelihood ratios are all strongly correlated, they do convey slightly different information: the separation between full siblings and half siblings is clearer with LLR(FS/HS) (left panel y-axis), while the separation between half siblings and not-siblings is clearer with LLR(HS/HA) (right panel y-axis).</p>
<p>The distributions of likelihood ratios can also be visualised as a set of histograms:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># to draw multiple histograms in the same plot: calculate first, plot later</span>
<span class="va">HistL_FSU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"maybesibs"</span>, <span class="st">"random"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">HistL_FSU</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LLR.HS.U"</span>, <span class="st">"LLR.FS.U"</span>, <span class="st">"LLR.FS.HS"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">HistL_FSU</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">y</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="va">y</span><span class="op">]</span>,
                                breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">60</span>, <span class="fl">60</span>, by<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>,   
                                plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>  
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># pick some colours</span>
<span class="va">COL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>maybesibs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"blue"</span>,alpha.f<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,
         random <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"black"</span>,alpha.f<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfcol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.9</span>,<span class="fl">.4</span>,<span class="fl">.4</span>,<span class="fl">.1</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LLR.HS.U"</span>, <span class="st">"LLR.FS.U"</span>, <span class="st">"LLR.FS.HS"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>, type<span class="op">=</span><span class="st">"n"</span>, main<span class="op">=</span><span class="st">""</span>, xlab<span class="op">=</span><span class="va">y</span>, ylab<span class="op">=</span><span class="st">"Count"</span>, las<span class="op">=</span><span class="fl">1</span>,
       xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25</span>, <span class="fl">25</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">0</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"maybesibs"</span>, <span class="st">"random"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">HistL_FSU</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">y</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="va">COL</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, border<span class="op">=</span><span class="cn">NA</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p><img src="pairLL_classification_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
<p>Again the distribution of LLR(FS/U) shows a fairly clear separation between full siblings (LLR(FS/U) &gt; 10), half siblings (-15 &lt; LLR(FS/U) &lt; 10) and unrelated (LLR(FS/U) &lt; -15), and is strongly correlated with LLR(FS/HS) (see scatterplot above). The main advantage of using LLR(FS/HS) to classify full vs half siblings is a practical one: the point of separation between the blobs (if there is one) will always be at 0. For LLR(HS/U), LLR(FS/U) and similar metrics the point of separation will vary between datasets with the number of SNPs, (assumed) genotyping error rate, allele frequencies, missingness, …, and a threshold would need to be estimated every time.</p>
<p>A heatmap may also be helpful to identify <em>which</em> pairs of relatives are likely to be full or half siblings. There are several ways to make a heatmap in R (none I find quite satisfactory), for example:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># using the first 20 individuals for this example</span>
<span class="co"># make a dataframe with all pairwise combinations:</span>
<span class="va">Pairs20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">SampleIDs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, each<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,
                      ID2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">SampleIDs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, times<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>
<span class="va">Pairs20</span> <span class="op">&lt;-</span> <span class="va">Pairs20</span><span class="op">[</span><span class="va">Pairs20</span><span class="op">$</span><span class="va">ID1</span> <span class="op">!=</span> <span class="va">Pairs20</span><span class="op">$</span><span class="va">ID2</span>, <span class="op">]</span> 

<span class="va">Pairs20.LL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalcPairLL.html">CalcPairLL</a></span><span class="op">(</span><span class="va">Pairs20</span>, 
                         <span class="va">Geno.2001</span>,
                         LifeHistData <span class="op">=</span> <span class="va">LHX</span>,
                         AgePrior <span class="op">=</span> <span class="va">AP</span>,
                         Complex <span class="op">=</span> <span class="st">"simp"</span>,
                         Err <span class="op">=</span> <span class="fl">0.005</span>, Plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="va">Pairs20.LL</span><span class="op">$</span><span class="va">FS.HS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Pairs20.LL</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">FS</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">FS</span> <span class="op">-</span> <span class="va">HS</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>  </code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># turn dataframe into a matrix</span>
<span class="va">FSHS.M</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/daply.html">daply</a></span><span class="op">(</span><span class="va">Pairs20.LL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID1"</span>, <span class="st">"ID2"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span><span class="op">$</span><span class="va">FS.HS</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co"># put the individuals back into their original order:</span>
<span class="va">FSHS.M</span> <span class="op">&lt;-</span> <span class="va">FSHS.M</span><span class="op">[</span><span class="va">SampleIDs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, <span class="va">SampleIDs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">]</span>

<span class="va">brks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span>, by<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fl">30</span><span class="op">)</span>  <span class="co"># group everything &lt; -15 or &gt;15 together</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">brks</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, palette <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span>

<span class="co"># image() is simple and flexible, but doesn't do a legend</span>
<span class="va">image_legend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">legend</span>, <span class="va">breaks</span>, <span class="va">col</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">x</span>, z<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,
        axes<span class="op">=</span><span class="cn">FALSE</span>, frame.plot<span class="op">=</span><span class="cn">TRUE</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">4</span>, at<span class="op">=</span><span class="va">legend</span>, las<span class="op">=</span><span class="fl">1</span>, cex.axis<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">4</span>, at<span class="op">=</span><span class="va">legend</span>, labels<span class="op">=</span><span class="cn">FALSE</span>, tck<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">2</span>, at<span class="op">=</span><span class="va">legend</span>, labels<span class="op">=</span><span class="cn">FALSE</span>, tck<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="va">title</span>, side<span class="op">=</span><span class="fl">3</span>, line<span class="op">=</span><span class="fl">0.5</span>, cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span>  
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, widths<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.8</span>,<span class="fl">.8</span>,<span class="fl">.5</span>,<span class="fl">.1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">FSHS.M</span><span class="op">)</span>, breaks<span class="op">=</span><span class="va">brks</span>, col <span class="op">=</span> <span class="va">cols</span>,
      axes <span class="op">=</span> <span class="cn">FALSE</span>, frame.plot<span class="op">=</span><span class="cn">TRUE</span>,
      xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, cex.lab<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">FSHS.M</span><span class="op">)</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,along.with<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">FSHS.M</span><span class="op">)</span><span class="op">)</span>, las<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">2</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">FSHS.M</span><span class="op">)</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,along.with<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">FSHS.M</span><span class="op">)</span><span class="op">)</span>, las<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>,<span class="fl">.2</span>,<span class="fl">.5</span>,<span class="fl">1.2</span><span class="op">)</span><span class="op">)</span>
<span class="fu">image_legend</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">19.5</span>, <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span><span class="fl">.25</span>,  <span class="co"># range of values </span>
             legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">16</span>, <span class="fl">16</span>, <span class="fl">2</span><span class="op">)</span>,     <span class="co"># positions of legend labels</span>
             breaks <span class="op">=</span> <span class="va">brks</span>, col <span class="op">=</span> <span class="va">cols</span>, title <span class="op">=</span> <span class="st">"LLR(FS/U)"</span><span class="op">)</span></code></pre></div>
<p><img src="pairLL_classification_files/figure-html/unnamed-chunk-11-1.png" width="70%"></p>
</div>
<div id="buffer-zone" class="section level3">
<h3 class="hasAnchor">
<a href="#buffer-zone" class="anchor"></a>Buffer zone</h3>
<p>While the <em>expectation</em> is that LLR(FS/HS) is positive for all full sibling pairs and negative for all other pairs, this does not mean that in imperfect real-world data all pairs will comply with this expectation. The solution that <code><a href="../reference/sequoia.html">sequoia()</a></code> implements is to not make an assignment if the likelihood ratio ‘close’ to zero, with ‘close’ defined by the threshold <code>Tassign</code>.</p>
<!--The more noise in the genetic data, the higher the chance the likelihood ratio will be on the wrong side of the threshold, and the more relevant the choice of `Tassign`. -->
<p>This may not be ideal in all situations, and you could apply a different tactic when classifying individuals based on the <code><a href="../reference/CalcPairLL.html">CalcPairLL()</a></code> output (see next section). For example, if you are sure based on other data that pairs are either full siblings or maternal half-siblings and never paternal half-siblings (e.g. they are litter mates), you could assign the maternal sibship but leave the paternity open (perhaps with a note). Or if you are interested in extra-pair paternity, you could be conservative and assign these as full siblings to the rest of the brood (see also the next section, and the section on <a href="#sec:withPedigree">conditioning on the pedigree</a>).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Tassign</span> <span class="op">&lt;-</span> <span class="fl">1.0</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">HistL_FSU</span><span class="op">[[</span><span class="st">"maybesibs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"LLR.FS.HS"</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="st">"darkblue"</span>, border<span class="op">=</span><span class="cn">NA</span>,
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span>, main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Tassign ="</span>, <span class="va">Tassign</span><span class="op">)</span>, 
     xlab<span class="op">=</span><span class="st">"LLR(FS/HS)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">0</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/rect.html">rect</a></span><span class="op">(</span>xleft<span class="op">=</span><span class="op">-</span><span class="va">Tassign</span>, xright<span class="op">=</span><span class="op">+</span><span class="va">Tassign</span>, ybottom<span class="op">=</span><span class="op">-</span><span class="fl">5</span>, ytop<span class="op">=</span><span class="fl">40</span>, 
     col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"red"</span>, alpha.f<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></code></pre></div>
<p><img src="pairLL_classification_files/figure-html/unnamed-chunk-12-1.png" width="50%"></p>
</div>
<div id="classify" class="section level3">
<h3 class="hasAnchor">
<a href="#classify" class="anchor"></a>Classify</h3>
<p>Classifying pairs of individuals at a given assignment threshold <code>Tassign</code> is straightforward:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Tassign</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"maybesibs"</span>, <span class="st">"random"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">PList</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,
                           <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">LLR.FS.HS</span> <span class="op">&gt;</span> <span class="va">Tassign</span>, <span class="st">"FS"</span>,
                                  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">LLR.HS.U</span> <span class="op">&gt;</span> <span class="va">Tassign</span>, <span class="st">"HS"</span>,
                                         <span class="st">"U"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">PList</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">class</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## $maybesibs
## 
##  FS  HS 
## 319 529 
## 
## $random
## 
##  FS  HS   U 
##  17  27 454</code></pre>
<p>Classifying sibling clusters is less straightforward, as the pairwise classifications are not necessarily consistent. For example, in the figure individuals A and B are highly likely to be full siblings, and so are A and C (at <span class="math inline">\(T_{assign}=0.5\)</span>), but B and C are more likely to be half-siblings.</p>
<div class="figure">
<img src="figs/LLR_FS-HS_trio_example.png" alt="Example LLR(FS/HS) for a putative full sibling trio" width="30%"><p class="caption">
Example LLR(FS/HS) for a putative full sibling trio
</p>
</div>
<p>The problem arises because the likelihoods of the three pairs are calculated independently of each other. During pedigree reconstruction, the problem is resolved by first assigning A and B as full siblings (which is unambiguous), and then calculating the likelihoods for C to be a full sibling vs half sibling to <em>both</em> A and B: <em>Conditional</em> on A and B being full siblings, C being a full sibling to one but not the other is not a valid pedigree configuration.</p>
</div>
</div>
<div id="sec:withPedigree" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:withPedigree" class="anchor"></a>Conditioning on a pedigree</h2>
<p>In datasets like this example, with a mixture of full- and half-siblings and no genotyped parents, usually clustering of full siblings is performed OK via <code><a href="../reference/sequoia.html">sequoia()</a></code>, but none of the half-siblings are assigned because it cannot tell whether they are maternal or paternal half-siblings.</p>
<p>So, first run the sibship clustering. As we will condition on this pedigree in the subsequent steps, we are being extra cautious and increase the assignment threshold:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SeqOUT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sequoia.html">sequoia</a></span><span class="op">(</span><span class="va">Geno.2001</span>, LifeHistData <span class="op">=</span> <span class="va">LHX</span>,
                  Err <span class="op">=</span> <span class="fl">0.005</span>, Tassign <span class="op">=</span> <span class="fl">1.0</span>,  
                  Complex <span class="op">=</span> <span class="st">"simp"</span>, Module<span class="op">=</span><span class="st">"ped"</span>, 
                  Plot<span class="op">=</span><span class="cn">FALSE</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div id="relationship-between-individual-cluster" class="section level3">
<h3 class="hasAnchor">
<a href="#relationship-between-individual-cluster" class="anchor"></a>Relationship between individual &amp; cluster</h3>
<p>When you provide a pedigree to <code><a href="../reference/CalcPairLL.html">CalcPairLL()</a></code>, all calculations will be conditional on this pedigree. This means it does not matter if you calculate the likelihoods A–C or B–C in the trio example; both will calculate the likelihoods of relationships between C and the A–B sibling duo.</p>
<p>To illustrate:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># true pedigree, 2 broods from 1 female:</span>
<span class="va">Ped.2001</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Ped.2001</span><span class="op">$</span><span class="va">dam</span> <span class="op">==</span> <span class="st">"a00014"</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
<pre><code>##         id    dam   sire
## 41  a01001 a00014 b00011
## 42  a01002 a00014 b00011
## 43  b01003 a00014 b00011
## 44  b01004 a00014 b00011
## 225 a01185 a00014 b00008
## 226 a01186 a00014 b00008
## 227 b01187 a00014 b00008
## 228 b01188 a00014 b00008</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Offspr_a14</span> <span class="op">&lt;-</span> <span class="va">Ped.2001</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Ped.2001</span><span class="op">$</span><span class="va">dam</span> <span class="op">==</span> <span class="st">"a00014"</span><span class="op">)</span>, <span class="st">"id"</span><span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># inferred pedigree:</span>
<span class="va">SeqOUT</span><span class="op">$</span><span class="va">Pedigree</span><span class="op">[</span><span class="va">SeqOUT</span><span class="op">$</span><span class="va">Pedigree</span><span class="op">$</span><span class="va">id</span> <span class="op">%in%</span> <span class="va">Offspr_a14</span>, <span class="op">]</span></code></pre></div>
<pre><code>##         id   dam  sire LLRdam LLRsire LLRpair OHdam OHsire MEpair
## 1   a01001 F0033 M0033   8.43    8.43   11.58    NA     NA     NA
## 2   a01002 F0033 M0033   7.92    7.92   17.27    NA     NA     NA
## 3   b01003 F0033 M0033   7.62    7.62   10.37    NA     NA     NA
## 4   b01004 F0033 M0033   9.54    9.54   16.25    NA     NA     NA
## 185 a01185 F0017 M0017   7.00    7.00    7.78    NA     NA     NA
## 186 a01186 F0017 M0017   6.79    6.79    5.87    NA     NA     NA
## 187 b01187 F0017 M0017   8.85    8.85   18.26    NA     NA     NA
## 188 b01188 F0017 M0017   9.19    9.19   13.97    NA     NA     NA</code></pre>
<p>To reiterate: the maternal sibship is divided into two sets of full siblings because <code><a href="../reference/sequoia.html">sequoia()</a></code> has no way of telling whether they share the same mother or the same father. This distinction can only be made when some parents of known sex are genotyped and the sibships interconnect: e.g. if male ‘b00008’ also mated with another female, who in turn also mated with a genotyped male (see also section on low assignment rate in main vignette).</p>
<p>Let’s calculate the likelihoods between the four members of the first brood and the first member of the second brood. For a meaningful answer, we temporarily drop both parents of the second individual (<code>dropPar2 = 'both'</code>): if two individuals have two different sets of parents, they cannot be siblings <em>conditional on those parents</em>. Now we calculate the likelihood that ‘a01185’ is a full sibling of half sibling to all of the first brood; if we had chosen <code>dropPar1='both'</code> we would calculate the likelihood of each member of the first brood being FS, HS, .. to the second brood.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">somePairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID1 <span class="op">=</span> <span class="va">Offspr_a14</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,
                        ID2 <span class="op">=</span> <span class="st">"a01185"</span>,
                        focal <span class="op">=</span> <span class="st">"HS"</span>,
                        dropPar2 <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span>  <span class="co"># drop parents of ID2</span>

<span class="va">somePairs.LL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalcPairLL.html">CalcPairLL</a></span><span class="op">(</span><span class="va">somePairs</span>, <span class="va">Geno.2001</span>,
                           Pedigree <span class="op">=</span> <span class="va">SeqOUT</span><span class="op">$</span><span class="va">Pedigree</span>,
                           Complex<span class="op">=</span><span class="st">"simp"</span>,
                           Err <span class="op">=</span> <span class="fl">0.005</span>, Plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">somePairs.LL</span></code></pre></div>
<pre><code>##      ID1    ID2 Sex1 Sex2 AgeDif focal patmat dropPar1 dropPar2  PO      FS
## 1 a01001 a01185    3    3     NA    HS      1     none     both 777 -340.91
## 2 a01002 a01185    3    3     NA    HS      1     none     both 777 -336.07
## 3 b01003 a01185    3    3     NA    HS      1     none     both 777 -341.86
## 4 b01004 a01185    3    3     NA    HS      1     none     both 777 -333.11
##        HS      GP      FA      HA       U TopRel  LLR
## 1 -303.02 -303.02 -303.02 -302.00 -305.13     HA 1.02
## 2 -298.18 -298.18 -298.18 -297.16 -300.29     HA 1.02
## 3 -303.97 -303.97 -303.97 -302.96 -306.08     HA 1.02
## 4 -295.22 -295.22 -295.22 -294.20 -297.33     HA 1.02</code></pre>
<p>For each pair, the likelihoods to be half-siblings (HS), grand-parental (GP) or full avuncular (FA) will be identical – another common <a href="vignette_main/book/key-points.html#sec:lowAR">cause for non-assignment</a></p>
<p>Note again that values &gt;0 in the output denote different kinds of <code>NA</code>, and are listed in the help file. For the ‘PO’ column, ‘777’ denotes ‘impossible’: the individuals in the first column already have a mother assigned in the pedigree that is conditioned upon, this parent is not temporarily dropped to do the calculations (<code>dropPar = 'none'</code>), and an individual can only have one mother. (the pair were also born in the same year and can therefore not be parent and offspring, but this information is not used: <code>AgeDif=NA</code>.)</p>
</div>
<div id="likelihood-ratios-2" class="section level3">
<h3 class="hasAnchor">
<a href="#likelihood-ratios-2" class="anchor"></a>Likelihood ratios</h3>
<p>The likelihoods differ between the pairs (because they have different genotypes), but the likelihood <em>ratios</em> do not (except due to rounding):</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">somePairs.LL</span><span class="op">$</span><span class="va">LLR.FS.HS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">somePairs.LL</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">FS</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">FS</span> <span class="op">-</span> <span class="va">HS</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
<span class="va">somePairs.LL</span><span class="op">$</span><span class="va">LLR.HS.U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">somePairs.LL</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">HS</span> <span class="op">-</span> <span class="va">U</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
<span class="va">somePairs.LL</span><span class="op">$</span><span class="va">LLR.HS.HA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">somePairs.LL</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">HA</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">HS</span> <span class="op">-</span> <span class="va">HA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="va">somePairs.LL</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID1"</span>, <span class="st">"ID2"</span>, <span class="st">"FS"</span>, <span class="st">"HS"</span>, <span class="st">"HA"</span>, <span class="st">"U"</span>, <span class="st">"LLR.FS.HS"</span>, <span class="st">"LLR.HS.U"</span>, <span class="st">"LLR.HS.HA"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>##      ID1    ID2      FS      HS      HA       U LLR.FS.HS LLR.HS.U LLR.HS.HA
## 1 a01001 a01185 -340.91 -303.02 -302.00 -305.13    -37.89     2.11     -1.02
## 2 a01002 a01185 -336.07 -298.18 -297.16 -300.29    -37.89     2.11     -1.02
## 3 b01003 a01185 -341.86 -303.97 -302.96 -306.08    -37.89     2.11     -1.01
## 4 b01004 a01185 -333.11 -295.22 -294.20 -297.33    -37.89     2.11     -1.02</code></pre>
<p>Compare these to the ratios when not conditioning on a pedigree:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">somePairs.LL.noped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalcPairLL.html">CalcPairLL</a></span><span class="op">(</span><span class="va">somePairs</span>, <span class="va">Geno.2001</span>,
                           Complex<span class="op">=</span><span class="st">"simp"</span>,
                           Err <span class="op">=</span> <span class="fl">0.005</span>, Plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="va">somePairs.LL.noped</span><span class="op">$</span><span class="va">LLR.FS.HS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">somePairs.LL.noped</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">FS</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">FS</span> <span class="op">-</span> <span class="va">HS</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
<span class="va">somePairs.LL.noped</span><span class="op">$</span><span class="va">LLR.HS.U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">somePairs.LL.noped</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">HS</span> <span class="op">-</span> <span class="va">U</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
<span class="va">somePairs.LL.noped</span><span class="op">$</span><span class="va">LLR.HS.HA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">somePairs.LL.noped</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">HA</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">HS</span> <span class="op">-</span> <span class="va">HA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="va">somePairs.LL.noped</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID1"</span>, <span class="st">"ID2"</span>, <span class="st">"FS"</span>, <span class="st">"HS"</span>, <span class="st">"HA"</span>, <span class="st">"U"</span>, <span class="st">"LLR.FS.HS"</span>, <span class="st">"LLR.HS.U"</span>, <span class="st">"LLR.HS.HA"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>##      ID1    ID2      FS      HS      HA       U LLR.FS.HS LLR.HS.U LLR.HS.HA
## 1 a01001 a01185  999.00 -338.19  999.00 -337.18        NA    -1.01        NA
## 2 a01002 a01185 -346.83 -335.85 -335.24 -337.58    -10.98     1.73     -0.61
## 3 b01003 a01185 -349.14 -334.12 -333.66 -335.53    -15.02     1.41     -0.46
## 4 b01004 a01185 -348.01 -334.24 -333.92 -335.87    -13.77     1.63     -0.32</code></pre>
</div>
<div id="half-sibling-clusters" class="section level3">
<h3 class="hasAnchor">
<a href="#half-sibling-clusters" class="anchor"></a>Half-sibling clusters</h3>
<p>For a pair of maternal half-siblings A and B, a third individual C must be identically related to both, but only ‘at that side of the family’: If C is a maternal grandmother to A, it is unavoidably also the maternal grandmother of B. But if C is the <em>paternal</em> grandmother of A, it could be unrelated to B. This distinction can be made via the <code>patmat</code> column.</p>
</div>
<div id="random-pairs-revisited" class="section level3">
<h3 class="hasAnchor">
<a href="#random-pairs-revisited" class="anchor"></a>random pairs revisited</h3>
<p>Calculating likelihoods for the same subset of pairs as before, now conditional on the inferred (partial) pedigree:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pairs.random.LL.wPed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalcPairLL.html">CalcPairLL</a></span><span class="op">(</span>Pairs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Pairs.random</span>,
                                            dropPar2 <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span>,
                              <span class="va">Geno.2001</span>,
                              Pedigree <span class="op">=</span> <span class="va">SeqOUT</span><span class="op">$</span><span class="va">Pedigree</span>,
                              LifeHistData <span class="op">=</span> <span class="va">LHX</span>,
                              AgePrior <span class="op">=</span> <span class="va">AP</span>,
                              Complex <span class="op">=</span> <span class="st">"simp"</span>,
                              Err <span class="op">=</span> <span class="fl">0.005</span>, Plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pairs.random.LL</span><span class="op">$</span><span class="va">LLR.FS.HS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Pairs.random.LL</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">FS</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">FS</span> <span class="op">-</span> <span class="va">HS</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
<span class="va">Pairs.random.LL.wPed</span><span class="op">$</span><span class="va">LLR.FS.HS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Pairs.random.LL.wPed</span>, 
                                        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">FS</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">HS</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">FS</span> <span class="op">-</span> <span class="va">HS</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfcol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.8</span>,<span class="fl">.8</span>,<span class="fl">.2</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">Pairs.random.LL</span><span class="op">$</span><span class="va">LLR.FS.HS</span>, breaks<span class="op">=</span><span class="fl">50</span>, main<span class="op">=</span><span class="st">"No pedigree"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">Pairs.random.LL.wPed</span><span class="op">$</span><span class="va">LLR.FS.HS</span>, breaks<span class="op">=</span><span class="fl">50</span>, main<span class="op">=</span><span class="st">"With pedigree"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="pairLL_classification_files/figure-html/pednoped-1.png" alt="Log10 likelihood ratios full sibling vs half sibling, calculated without pedigree (left) and conditional on a partial inferred pedigree (right). Note difference in scale on the x-axes. " width="90%"><p class="caption">
Log10 likelihood ratios full sibling vs half sibling, calculated without pedigree (left) and conditional on a partial inferred pedigree (right). Note difference in scale on the x-axes.
</p>
</div>
</div>
<div id="pros-cons" class="section level3">
<h3 class="hasAnchor">
<a href="#pros-cons" class="anchor"></a>Pros &amp; cons</h3>
<p>The main advantage of calculating likelihoods conditional on a pedigree is that the distinction between different relationships tends to become much clearer once you condition on at least one parent for either individual.</p>
<p>The main disadvantage is that if the pedigree you condition on is incorrect, there is no meaningful way to interpret the likelihoods.</p>
<p>Another disadvantage can be that computation is considerably slower (order of magnitudes), making it more important to filter pairs first using <code><a href="../reference/GetMaybeRel.html">GetMaybeRel()</a></code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jisca Huisman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
