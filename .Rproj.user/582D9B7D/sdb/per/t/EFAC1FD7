{
    "collab_server" : "",
    "contents" : "# improving upon Deer_est_confidence.R\n\nlibrary(sequoia)\nsetwd(\"E:/Rum red deer/Pedigree 2018 cohort\")\nDeerPed18 <- read.table(\"Pedigree_2019-07-02_DB.txt\", header=T, stringsAsFactors=F)\nDeerPed.old <- read.table(\"Pedigree_database_2018-07.txt\", header=T, stringsAsFactors=F,\n                          sep=\"\\t\", na=\"\")\nDeerRefLH <- read.table(\"CodeSexBY.txt\", header=T, stringsAsFactors=F)\nGM <- as.matrix(read.table(\"Deer_Geno_2019-06-18.txt\", row.names=1, stringsAsFactors=F))\n\n\n\n#~~~~~~~~~~~~~~~~~~~\nDeerPed.tmp <- merge(DeerPed18[, 1:3],\n                     DeerPed.old[, c(\"Code\", \"MumCode\", \"Sire\")],\n                     all = TRUE)\nDeerRefPed <- with(DeerPed.tmp, data.frame(id = Code,\n                                           dam = ifelse(!is.na(MumCode), MumCode, Mother),\n                                           sire = ifelse(!is.na(Sire), Sire, Father),\n                                           stringsAsFactors=FALSE))\n# exclude dummies in Ped18 which are not used (e.g. already dummy in DB)\nexcl <- with(DeerRefPed, (substr(id,1,2)==\"M0\" & !id %in% sire) |\n               (substr(id,1,2) ==\"F0\" & !id %in% dam))\n# checked some. OK.\nDeerRefPed <- DeerRefPed[!excl, ]  # n=63\n\n\n# also exclude loose indiv (no parents, no offspring)\nLoose <- with(DeerRefPed, is.na(dam) & is.na(sire) & !id %in% dam & !id %in% sire)\nDeerRefPed <- DeerRefPed[!Loose, ]  # 643. incl. bunch of superseded dummy codes; mystery '74 rut, etc.\n\n# left: n=4756\n\n\n#~~~~~~~~~~~~~~~~~~~\nStats <- SnpStats(GM, DeerRefPed)\nhist(Stats[,\"Err.hat\"], breaks=100, col=\"grey\", ylim=c(0, 20))\n# only 4 SNPs with some suggestion of error (0.0015 - 0.00234)\nmean(Stats$Err.hat)   # 8.2E-5\n\nmean(Stats$Mis)   # 0.000113  (1.1E-4)\n\n\nSNPd <- row.names(GM)\n\n\nParPropSNPd <- with(DeerRefPed, c(sum(dam %in% SNPd)/sum(!is.na(dam)),\n                                  sum(sire %in% SNPd)/sum(!is.na(sire))))\n# 0.699 0.783\n\nwith(DeerRefPed, c(mean(!is.na(dam)), mean(!is.na(sire))))\n# 0.935   0.654\n\n\n#~~~~~~~~~~~~~~~~~~~\n\nconf.deer <- EstConf(Ped = DeerRefPed,\n                     LifeHistData = DeerRefLH,\n                     args.sim = list(nSnp = 440, SnpError = 5e-4, ParMis=c(0.3, 0.2)),\n                     args.seq = list(MaxSibIter = 10, Err=1e-4),\n                     nSim = 10)\n\n# save(conf.deer, DeerRefPed, file=\"ConfEst_2020-05-04.RData\")  -- no good.\nsave(conf.deer, file=\"ConfEst_2020-05-05.RData\")  # DeerRefPed included.\n\nconf.deer$ConfProb\n#    id.cat dam.cat sire.cat dam.conf sire.conf pair.conf     N\n# 1       G       G        G  0.99993    1.0000   0.99993 15308\n# 2       G       G        D  1.00000    0.9994   0.99940  3662\n# 3       G       G        X  1.00000        NA        NA  9915\n# 4       G       D        G  0.99970    1.0000   0.99970  6458\n# 5       G       D        D  0.99930    1.0000   0.99930  1548\n# 6       G       D        X  1.00000        NA        NA  4195\n# 7       G       X        G       NA    1.0000        NA   923\n# 8       G       X        D       NA    1.0000        NA   236\n# 9       G       X        X       NA        NA        NA  1465\n# 10      D       G        G  1.00000    1.0000   1.00000  1612\n# 11      D       G        D  1.00000    1.0000   1.00000   300\n# 12      D       G        X  1.00000        NA        NA   344\n# 13      D       D        G  0.99800    1.0000   0.99800   642\n# 14      D       D        D  1.00000    1.0000   1.00000   110\n# 15      D       D        X  0.89900        NA        NA   109  << low!\n# 16      D       X        G       NA    1.0000        NA   165\n# 17      D       X        D       NA    1.0000        NA    24\n# 18      D       X        X       NA        NA        NA   337\n\n\napply(conf.deer$SimCountsDetail[,\"D\",\"D\",,,], 2:3, sum)\n#         dam.class\n# sire.cat Match Mismatch P1only P2only _\n#        G   449        1    192      0 0\n#        D    82        0     28      0 0\n#        X    13        0     96      0 0\n\nsum(conf.deer$SimCountsDetail[,\"D\",\"D\",\"X\",,])  # 109. OK.\n\n\n\n#~~~~~~~~~~~~~~~~~~~~~~~~~~\n# TODO: for age = extra.\n\n",
    "created" : 1588621898417.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3408527771",
    "id" : "EFAC1FD7",
    "lastKnownWriteTime" : 1588666907,
    "last_content_update" : 1588666907879,
    "path" : "E:/Rum red deer/Pedigree 2018 cohort/Deer_EstConf_2020.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}